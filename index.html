<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/14384/14384748.png">
  <link rel="manifest" href="data:application/json,{
    'name': 'LiLyrics - Songwriting Studio',
    'short_name': 'LiLyrics',
    'description': 'Professional songwriting and lyric creation studio',
    'theme_color': '#4285f4',
    'background_color': '#ffffff',
    'display': 'standalone',
    'start_url': '/',
    'icons': [
      {'src': 'https://cdn-icons-png.flaticon.com/512/14384/14384748.png', 'sizes': '512x512', 'type': 'image/png'}
    ]
  }">
  <title>LiLyrics v2.0 - International Songwriting Studio</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap');
    
    :root {
      --primary-color: #4285f4;
      --secondary-color: #34a853;
      --error-color: #ea4335;
      --warning-color: #fbbc04;
      --surface-color: #ffffff;
      --background-color: #fafafa;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --border-color: #dadce0;
      --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-elevated: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
      
      /* Font families for different languages */
      --font-latin: 'Roboto', sans-serif;
      --font-arabic: 'Noto Sans Arabic', sans-serif;
      --font-japanese: 'Noto Sans JP', sans-serif;
      --font-korean: 'Noto Sans KR', sans-serif;
      --font-devanagari: 'Noto Sans Devanagari', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }
    
    /* RTL Support */
    [dir="rtl"] {
      text-align: right;
    }
    
    [dir="rtl"] .logo-line {
      flex-direction: row-reverse;
    }
    
    [dir="rtl"] .tab .tab-icon {
      margin-left: 6px;
      margin-right: 0;
    }
    
    [dir="rtl"] .tab .close-btn {
      margin-right: 8px;
      margin-left: 0;
    }
    
    body {
      margin: 0;
      font-family: var(--font-latin);
      background: var(--background-color);
      color: var(--text-primary);
      transition: all 0.3s ease;
      line-height: 1.5;
    }
    
    /* Language-specific fonts */
    body[lang="ar"] {
      font-family: var(--font-arabic);
    }
    
    body[lang="ja"] {
      font-family: var(--font-japanese);
    }
    
    body[lang="ko"] {
      font-family: var(--font-korean);
    }
    
    body[lang="hi"] {
      font-family: var(--font-devanagari);
    }
    
    /* Enhanced animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes glow {
      from { box-shadow: 0 0 20px rgba(66, 133, 244, 0.3); }
      to { box-shadow: 0 0 30px rgba(66, 133, 244, 0.6); }
    }
    
    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    /* PWA Install prompt */
    .pwa-install {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary-color);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow-elevated);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    
    .pwa-install button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    /* Language Selector */
    .language-selector {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
    }
    
    .language-selector select {
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--text-primary);
      outline: none;
      cursor: pointer;
      box-shadow: var(--shadow);
    }
    
    /* Connection Status */
    .connection-status {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--error-color);
      color: white;
      text-align: center;
      padding: 8px;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
      z-index: 1001;
    }
    
    .connection-status.offline {
      transform: translateY(0);
      background: var(--warning-color);
      color: var(--text-primary);
    }
    
    .connection-status.online {
      background: var(--secondary-color);
      transform: translateY(0);
    }
    
    /* Enhanced FREE PROMO BANNER */
    .promo-banner {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      text-align: center;
      padding: 16px;
      font-weight: 500;
      animation: glow 2s ease-in-out infinite alternate;
      position: relative;
      overflow: hidden;
    }
    
    .promo-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 3s infinite;
    }
    
    .promo-text {
      position: relative;
      z-index: 1;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .promo-highlight {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }
    
    /* Enhanced Header */
    header {
      text-align: center;
      padding: 24px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      position: relative;
      box-shadow: var(--shadow);
    }
    
    .logo-line {
      font-family: 'Monotype Corsiva', cursive;
      font-size: 36px;
      font-weight: 700;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      animation: fadeIn 0.6s ease;
    }
    
    .logo-line img {
      width: 32px;
      height: 32px;
      animation: pulse 2s infinite;
    }
    
    .tagline {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 8px;
      font-weight: 400;
    }
    
    .version-badge {
      position: absolute;
      top: 15px;
      right: 60px;
      background: var(--secondary-color);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }
    
    #darkToggle {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    
    #darkToggle:hover {
      background: rgba(0,0,0,0.1);
    }
    
    /* Enhanced Tabs */
    #tabs {
      display: flex;
      flex-wrap: nowrap;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      padding: 0 16px;
      overflow-x: auto;
      overflow-y: hidden;
      white-space: nowrap;
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) transparent;
      box-shadow: var(--shadow);
    }
    
    #tabs::-webkit-scrollbar {
      height: 6px;
    }
    
    #tabs::-webkit-scrollbar-track {
      background: transparent;
    }
    
    #tabs::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }
    
    .tab {
      display: inline-flex;
      align-items: center;
      padding: 12px 16px;
      cursor: pointer;
      border-right: 1px solid var(--border-color);
      flex-shrink: 0;
      min-width: max-content;
      white-space: nowrap;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .tab:hover {
      background: rgba(66, 133, 244, 0.04);
    }
    
    .tab.active {
      background: var(--surface-color);
      border-bottom: 3px solid var(--primary-color);
      font-weight: 500;
      color: var(--primary-color);
    }
    
    .tab .tab-icon {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      opacity: 0.8;
    }
    
    .tab .close-btn {
      margin-left: 8px;
      color: var(--error-color);
      font-weight: bold;
      cursor: pointer;
      flex-shrink: 0;
      padding: 2px 6px;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    
    .tab .close-btn:hover {
      background: rgba(234, 67, 53, 0.1);
    }
    
    /* Enhanced Controls */
    #controls {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      flex-wrap: wrap;
      align-items: center;
      box-shadow: var(--shadow);
    }
    
    button, select, input[type="search"] {
      padding: 8px 16px;
      font-size: 14px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--surface-color);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      outline: none;
    }
    
    button:hover {
      background: rgba(66, 133, 244, 0.04);
      border-color: var(--primary-color);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.primary {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    button.primary:hover {
      background: #3367d6;
      box-shadow: var(--shadow-elevated);
    }
    
    /* Enhanced Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background: var(--surface-color);
      min-width: 180px;
      box-shadow: var(--shadow-elevated);
      z-index: 10;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      top: 100%;
      left: 0;
      overflow: hidden;
      animation: fadeIn 0.2s ease;
    }
    
    .dropdown-content button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
      margin: 0;
      padding: 12px 16px;
      background: var(--surface-color);
      color: var(--text-primary);
      transition: background 0.2s ease;
    }
    
    .dropdown-content button:hover {
      background: rgba(66, 133, 244, 0.04);
      transform: none;
    }
    
    .dropdown:hover .dropdown-content {
      display: block;
    }
    
    /* Enhanced Text Area */
    #pad {
      width: 100%;
      height: 60vh;
      padding: 24px;
      font-family: var(--font-mono);
      font-size: 16px;
      line-height: 1.6;
      border: none;
      outline: none;
      resize: none;
      box-sizing: border-box;
      background: var(--surface-color);
      color: var(--text-primary);
      position: relative;
      border-top: 1px solid var(--border-color);
    }
    
    #pad:focus {
      background: #fafbff;
    }
    
    /* AI Assistant Panel */
    .ai-assistant {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 300px;
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: var(--shadow-elevated);
      display: none;
      z-index: 100;
      animation: slideIn 0.3s ease;
    }
    
    .ai-assistant.active {
      display: block;
    }
    
    .ai-header {
      padding: 16px;
      border-bottom: 1px solid var(--border-color);
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .ai-content {
      padding: 16px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .ai-suggestion {
      background: rgba(66, 133, 244, 0.04);
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .ai-suggestion:hover {
      background: rgba(66, 133, 244, 0.08);
    }
    
    /* Enhanced Statistics */
    #rhymes {
      padding: 20px 24px;
      font-size: 14px;
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
      color: var(--text-secondary);
      min-height: 60px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 16px;
      box-shadow: var(--shadow);
    }
    
    #stats-mini {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
      min-width: 300px;
    }
    
    .stat-item {
      text-align: center;
      padding: 8px;
      background: rgba(66, 133, 244, 0.04);
      border-radius: 8px;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    #current-file-name {
      color: var(--primary-color);
      font-weight: 600;
      font-size: 14px;
    }
    
    /* Enhanced Focus Mode */
    #focusModeToggle {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 999;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: var(--shadow-elevated);
      transition: all 0.3s ease;
      display: none;
    }
    
    body.focus-mode #focusModeToggle {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    #focusModeToggle:hover {
      background: #3367d6;
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    /* Enhanced Modals */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface-color);
      padding: 32px;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      animation: fadeIn 0.3s ease;
    }
    
    .modal h2 {
      margin: 0 0 24px 0;
      color: var(--text-primary);
      font-weight: 500;
    }
    
    /* Enhanced Settings Tabs */
    .settings-tabs {
      display: flex;
      margin-bottom: 24px;
      border-bottom: 2px solid var(--border-color);
      flex-wrap: wrap;
      gap: 4px;
    }
    
    .settings-tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      flex-shrink: 0;
      transition: all 0.2s ease;
      border-radius: 6px 6px 0 0;
      font-weight: 500;
    }
    
    .settings-tab:hover {
      background: rgba(66, 133, 244, 0.04);
    }
    
    .settings-tab.active {
      border-bottom-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(66, 133, 244, 0.04);
    }
    
    /* Export Options */
    .export-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    
    .export-option {
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .export-option:hover {
      border-color: var(--primary-color);
      background: rgba(66, 133, 244, 0.04);
    }
    
    .export-option h4 {
      margin: 8px 0;
      color: var(--text-primary);
    }
    
    .export-option p {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    /* Dark Mode Enhancements */
    body.dark {
      --surface-color: #1f1f1f;
      --background-color: #121212;
      --text-primary: #e8eaed;
      --text-secondary: #9aa0a6;
      --border-color: #3c4043;
    }
    
    body.dark .promo-banner {
      background: linear-gradient(135deg, #1565c0, #2e7d32);
    }
    
    body.dark #pad:focus {
      background: #252525;
    }
    
    /* Sepia Mode Enhancements */
    body.sepia {
      --surface-color: #f8f2e4;
      --background-color: #f4ecd8;
      --text-primary: #40352b;
      --text-secondary: #6b5d50;
      --border-color: #d4c4a8;
      --primary-color: #8B4513;
    }
    
    body.sepia .promo-banner {
      background: linear-gradient(135deg, #8B4513, #A0522D);
    }
    
    /* Focus Mode */
    body.focus-mode #controls,
    body.focus-mode #tabs,
    body.focus-mode header,
    body.focus-mode #rhymes,
    body.focus-mode .promo-banner,
    body.focus-mode .ai-assistant {
      display: none;
    }
    
    body.focus-mode #pad {
      height: 100vh;
      border: none;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .promo-text {
        font-size: 14px;
        flex-direction: column;
        gap: 4px;
      }
      
      .logo-line {
        font-size: 28px;
      }
      
      #controls {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
      
      .settings-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
      }
      
      .ai-assistant {
        width: 90%;
        right: 5%;
      }
      
      #stats-mini {
        grid-template-columns: repeat(2, 1fr);
        min-width: auto;
      }
    }
    
    @media (max-width: 480px) {
      header {
        padding: 16px;
      }
      
      .version-badge {
        display: none;
      }
      
      #pad {
        height: 50vh;
        padding: 16px;
        font-size: 15px;
      }
      
      #focusModeToggle {
        top: 16px;
        right: 16px;
        padding: 10px 16px;
        font-size: 13px;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Connection Status -->
  <div id="connectionStatus" class="connection-status">
    <span id="connectionText">Checking connection...</span>
  </div>

  <!-- PWA Install Prompt -->
  <div id="pwaInstall" class="pwa-install">
    <span>üì± Install LiLyrics as an app for better experience!</span>
    <button onclick="installPWA()">Install</button>
    <button onclick="dismissInstall()">&times;</button>
  </div>

  <!-- FREE PROMO BANNER -->
  <div class="promo-banner">
    <div class="promo-text">
      <span>üéâ</span>
      <span class="promo-highlight" data-i18n="free-access">FREE ACCESS</span>
      <span data-i18n="to-all-premium">to ALL Premium Features until</span>
      <span class="promo-highlight">December 31, 2025!</span>
      <span>üéµ</span>
    </div>
  </div>

  <header>
    <!-- Language Selector -->
    <div class="language-selector">
      <select id="languageSelect" onchange="changeLanguage(this.value)">
        <option value="en">üá∫üá∏ English</option>
        <option value="es">üá™üá∏ Espa√±ol</option>
        <option value="fr">üá´üá∑ Fran√ßais</option>
        <option value="de">üá©üá™ Deutsch</option>
        <option value="it">üáÆüáπ Italiano</option>
        <option value="pt">üáßüá∑ Portugu√™s</option>
        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
        <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
        <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
        <option value="hi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
        <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      </select>
    </div>
    
    <div class="logo-line">
      <img src="https://cdn-icons-png.flaticon.com/512/14384/14384748.png" alt="Lyrics Icon"/>
      <span>LiLyrics</span>
    </div>
    <div class="tagline" data-i18n="tagline">International Songwriting Studio</div>
    <div class="version-badge">v2.0</div>
    <button id="darkToggle" title="Toggle dark mode">üåô</button>
  </header>
  
  <div id="tabs"></div>
  
  <!-- Focus Mode Toggle Button -->
  <button id="focusModeToggle" onclick="toggleFocusMode()" title="Exit Focus Mode">
    <span data-i18n="writing-mode">‚úèÔ∏è Writing Mode</span>
  </button>
  
  <!-- AI Assistant Panel -->
  <div id="aiAssistant" class="ai-assistant">
    <div class="ai-header">
      <span>ü§ñ <span data-i18n="ai-assistant">AI Assistant</span></span>
      <button onclick="toggleAI()" style="background: none; border: none; cursor: pointer;">√ó</button>
    </div>
    <div class="ai-content">
      <div id="aiSuggestions">
        <p data-i18n="ai-loading">Loading AI suggestions...</p>
      </div>
      <button onclick="generateAISuggestions()" class="primary" style="width: 100%; margin-top: 12px;">
        <span data-i18n="get-suggestions">Get Suggestions</span>
      </button>
    </div>
  </div>
  
  <div id="controls">
    <!-- File Dropdown -->
    <div class="dropdown">
      <button data-i18n="file">üìÅ File</button>
      <div class="dropdown-content">
        <button onclick="newProject()"><span data-i18n="new-project">üÜï New Project</span></button>
        <button onclick="saveToFile()"><span data-i18n="save-txt">üíæ Save as TXT</span></button>
        <button onclick="document.getElementById('fileInput').click()"><span data-i18n="open-file">üìÇ Open File</span></button>
        <button onclick="showExportModal()"><span data-i18n="export-options">üìÑ Export Options</span></button>
      </div>
    </div>
    
    <button onclick="undo()"><span data-i18n="undo">‚Ü©Ô∏è Undo</span></button>
    <button onclick="redo()"><span data-i18n="redo">‚Ü™Ô∏è Redo</span></button>
    
    <select id="fontSelect" onchange="changeFont()">
      <option value="'Verdana', sans-serif" selected>Verdana</option>
      <option value="'Arial', sans-serif">Arial</option>
      <option value="'Times New Roman', serif">Times New Roman</option>
      <option value="'Georgia', serif">Georgia</option>
      <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
      <option value="'Roboto', sans-serif">Roboto</option>
    </select>
    
    <input type="search" id="searchBox" data-i18n-placeholder="search-placeholder" placeholder="Search...">
    <input type="file" id="fileInput" style="display:none" accept=".txt,.json" onchange="loadFromFile(event)"/>
    
    <button onclick="toggleAI()" class="primary">
      <span data-i18n="ai-assistant">ü§ñ AI Assistant</span>
    </button>
    <button onclick="promptSuggestRhymes()"><span data-i18n="suggest-rhymes">üîé Suggest Rhymes</span></button>
    <button onclick="showPrompt()"><span data-i18n="inspire-me">üí° Inspire Me</span></button>
    <button onclick="toggleVoiceRecording()"><span data-i18n="voice-memo">üé§ Voice Memo</span></button>
    <button onclick="toggleRhymeScheme()"><span data-i18n="rhyme-colors">üé® Rhyme Colors</span></button>
    <button onclick="toggleFocusMode()"><span data-i18n="focus-mode">üéØ Focus Mode</span></button>
    <button onclick="toggleSepia()"><span data-i18n="sepia">üü§ Sepia</span></button>
    <button onclick="showSettings()"><span data-i18n="settings">‚öôÔ∏è Settings</span></button>
  </div>
  
  <textarea id="pad" data-i18n-placeholder="pad-placeholder" placeholder="Write your lyrics here..."></textarea>
  
  <div id="rhymes">
    <div id="rhyme-suggestions"></div>
    <div id="stats-mini">
      <div class="stat-item">
        <div class="stat-value" id="word-count">0</div>
        <div class="stat-label" data-i18n="words">Words</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="char-count">0</div>
        <div class="stat-label" data-i18n="characters">Characters</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="line-count">0</div>
        <div class="stat-label" data-i18n="lines">Lines</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="session-time">0m</div>
        <div class="stat-label" data-i18n="session">Session</div>
      </div>
      <div class="stat-item" style="grid-column: span 2;">
        <div class="stat-value" id="current-file-name">Untitled</div>
        <div class="stat-label" data-i18n="current-project">Current Project</div>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal">
    <div class="modal-content">
      <h2 data-i18n="export-options">üìÑ Export Options</h2>
      <div class="export-grid">
        <div class="export-option" onclick="exportPDF()">
          <div style="font-size: 24px;">üìÑ</div>
          <h4>PDF</h4>
          <p data-i18n="pdf-desc">Professional PDF document</p>
        </div>
        <div class="export-option" onclick="saveToFile()">
          <div style="font-size: 24px;">üìù</div>
          <h4>TXT</h4>
          <p data-i18n="txt-desc">Plain text file</p>
        </div>
        <div class="export-option" onclick="exportAllProjects()">
          <div style="font-size: 24px;">üì¶</div>
          <h4>JSON</h4>
          <p data-i18n="json-desc">All projects backup</p>
        </div>
        <div class="export-option" onclick="exportRTF()">
          <div style="font-size: 24px;">üìã</div>
          <h4>RTF</h4>
          <p data-i18n="rtf-desc">Rich text format</p>
        </div>
        <div class="export-option" onclick="exportWord()">
          <div style="font-size: 24px;">üìÑ</div>
          <h4>DOCX</h4>
          <p data-i18n="docx-desc">Microsoft Word document</p>
        </div>
        <div class="export-option" onclick="shareToSocial()">
          <div style="font-size: 24px;">üì±</div>
          <h4 data-i18n="share">Share</h4>
          <p data-i18n="share-desc">Social media & messaging</p>
        </div>
      </div>
      <button onclick="hideExportModal()" style="margin-top: 20px;" data-i18n="close">Close</button>
    </div>
  </div>

  <!-- Enhanced Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="settings-tabs">
        <div class="settings-tab active" onclick="showSettingsTab('shortcuts')">
          <span data-i18n="shortcuts">üéπ Shortcuts</span>
        </div>
        <div class="settings-tab" onclick="showSettingsTab('stats')">
          <span data-i18n="statistics">üìä Statistics</span>
        </div>
        <div class="settings-tab" onclick="showSettingsTab('templates')">
          <span data-i18n="templates">üìù Templates</span>
        </div>
        <div class="settings-tab" onclick="showSettingsTab('ai')">
          <span data-i18n="ai-settings">ü§ñ AI Settings</span>
        </div>
        <div class="settings-tab" onclick="showSettingsTab('advanced')">
          <span data-i18n="advanced">üîß Advanced</span>
        </div>
        <div class="settings-tab" onclick="showSettingsTab('about')">
          <span data-i18n="about">üéâ About</span>
        </div>
      </div>
      
      <!-- Settings Panels (keeping original content structure but with i18n attributes) -->
      <div id="shortcuts-panel" class="settings-panel active">
        <h3 data-i18n="keyboard-shortcuts">üéπ Keyboard Shortcuts</h3>
        <div class="shortcut-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="save-project">Save Current Project</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + S</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="copy-lyrics">Copy Lyrics</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + C</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="paste-text">Paste Text</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + V</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="select-all">Select All</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + A</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="undo">Undo</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + Z</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span data-i18n="redo">Redo</span>
            <span style="font-weight: bold; color: var(--primary-color);">Ctrl + Y</span>
          </div>
        </div>
      </div>
      
      <div id="ai-panel" class="settings-panel">
        <h3 data-i18n="ai-configuration">ü§ñ AI Configuration</h3>
        <p data-i18n="ai-desc">Configure AI-powered writing assistance and suggestions.</p>
        <div style="margin: 20px 0;">
          <label>
            <input type="checkbox" id="aiEnabled" checked>
            <span data-i18n="enable-ai">Enable AI suggestions</span>
          </label><br><br>
          <label>
            <input type="checkbox" id="autoSuggest" checked>
            <span data-i18n="auto-suggest">Auto-suggest while typing</span>
          </label><br><br>
          <label>
            <input type="checkbox" id="rhymeAssist">
            <span data-i18n="rhyme-assist">Smart rhyme assistance</span>
          </label><br><br>
          <label>
            <input type="checkbox" id="grammarCheck">
            <span data-i18n="grammar-check">Grammar checking</span>
          </label>
        </div>
        <button onclick="testAI()" class="primary" data-i18n="test-ai">Test AI Connection</button>
      </div>
      
      <!-- Other panels would follow similar pattern with i18n attributes -->
      
      <br>
      <button onclick="hideSettings()" class="primary" data-i18n="close">Close Settings</button>
    </div>
  </div>

  <!-- Voice Recording Modal (keeping original structure) -->
  <div id="voiceModal" class="modal">
    <div class="modal-content" style="text-align: center;">
      <h3 data-i18n="voice-memo">üé§ Voice Memo</h3>
      <p id="recording-status" data-i18n="click-to-record">Click to start recording</p>
      <button id="record-btn" style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary-color); color: white; border: none; font-size: 24px; cursor: pointer; margin: 20px;" onclick="toggleRecording()">üé§</button>
      <div id="recordings-list"></div>
      <button onclick="hideVoiceModal()" class="primary" style="margin: 10px;" data-i18n="close">Close</button>
    </div>
  </div>

  <script>
    // ===== INTERNATIONALIZATION SYSTEM =====
    
    const translations = {
      en: {
        'free-access': 'FREE ACCESS',
        'to-all-premium': 'to ALL Premium Features until',
        'tagline': 'International Songwriting Studio',
        'writing-mode': '‚úèÔ∏è Writing Mode',
        'ai-assistant': 'AI Assistant',
        'ai-loading': 'Loading AI suggestions...',
        'get-suggestions': 'Get Suggestions',
        'file': 'üìÅ File',
        'new-project': 'üÜï New Project',
        'save-txt': 'üíæ Save as TXT',
        'open-file': 'üìÇ Open File',
        'export-options': 'üìÑ Export Options',
        'undo': '‚Ü©Ô∏è Undo',
        'redo': '‚Ü™Ô∏è Redo',
        'search-placeholder': 'Search...',
        'suggest-rhymes': 'üîé Suggest Rhymes',
        'inspire-me': 'üí° Inspire Me',
        'voice-memo': 'üé§ Voice Memo',
        'rhyme-colors': 'üé® Rhyme Colors',
        'focus-mode': 'üéØ Focus Mode',
        'sepia': 'üü§ Sepia',
        'settings': '‚öôÔ∏è Settings',
        'pad-placeholder': 'Write your lyrics here...',
        'words': 'Words',
        'characters': 'Characters',
        'lines': 'Lines',
        'session': 'Session',
        'current-project': 'Current Project',
        'close': 'Close',
        'share': 'Share',
        'shortcuts': 'üéπ Shortcuts',
        'statistics': 'üìä Statistics',
        'templates': 'üìù Templates',
        'ai-settings': 'ü§ñ AI Settings',
        'advanced': 'üîß Advanced',
        'about': 'üéâ About',
        'offline-mode': 'üì¥ You are offline. Changes saved locally.',
        'online-mode': 'üåê Connected to internet.',
        'install-app': 'üì± Install LiLyrics as an app for better experience!'
      },
      es: {
        'free-access': 'ACCESO GRATUITO',
        'to-all-premium': 'a TODAS las funciones Premium hasta el',
        'tagline': 'Estudio Internacional de Composici√≥n',
        'writing-mode': '‚úèÔ∏è Modo Escritura',
        'ai-assistant': 'Asistente IA',
        'ai-loading': 'Cargando sugerencias de IA...',
        'get-suggestions': 'Obtener Sugerencias',
        'file': 'üìÅ Archivo',
        'new-project': 'üÜï Nuevo Proyecto',
        'save-txt': 'üíæ Guardar como TXT',
        'open-file': 'üìÇ Abrir Archivo',
        'export-options': 'üìÑ Opciones de Exportar',
        'undo': '‚Ü©Ô∏è Deshacer',
        'redo': '‚Ü™Ô∏è Rehacer',
        'search-placeholder': 'Buscar...',
        'suggest-rhymes': 'üîé Sugerir Rimas',
        'inspire-me': 'üí° Inspirarme',
        'voice-memo': 'üé§ Nota de Voz',
        'rhyme-colors': 'üé® Colores de Rima',
        'focus-mode': 'üéØ Modo Enfoque',
        'sepia': 'üü§ Sepia',
        'settings': '‚öôÔ∏è Configuraci√≥n',
        'pad-placeholder': 'Escribe tus letras aqu√≠...',
        'words': 'Palabras',
        'characters': 'Caracteres',
        'lines': 'L√≠neas',
        'session': 'Sesi√≥n',
        'current-project': 'Proyecto Actual',
        'close': 'Cerrar',
        'share': 'Compartir'
      },
      fr: {
        'free-access': 'ACC√àS GRATUIT',
        'to-all-premium': '√† TOUTES les fonctionnalit√©s Premium jusqu\'au',
        'tagline': 'Studio International d\'√âcriture de Chansons',
        'writing-mode': '‚úèÔ∏è Mode √âcriture',
        'ai-assistant': 'Assistant IA',
        'ai-loading': 'Chargement des suggestions IA...',
        'get-suggestions': 'Obtenir des Suggestions',
        'file': 'üìÅ Fichier',
        'new-project': 'üÜï Nouveau Projet',
        'save-txt': 'üíæ Sauvegarder en TXT',
        'open-file': 'üìÇ Ouvrir un Fichier',
        'export-options': 'üìÑ Options d\'Export',
        'undo': '‚Ü©Ô∏è Annuler',
        'redo': '‚Ü™Ô∏è Refaire',
        'search-placeholder': 'Rechercher...',
        'suggest-rhymes': 'üîé Sugg√©rer des Rimes',
        'inspire-me': 'üí° M\'inspirer',
        'voice-memo': 'üé§ M√©mo Vocal',
        'rhyme-colors': 'üé® Couleurs de Rime',
        'focus-mode': 'üéØ Mode Focus',
        'sepia': 'üü§ S√©pia',
        'settings': '‚öôÔ∏è Param√®tres',
        'pad-placeholder': '√âcrivez vos paroles ici...',
        'words': 'Mots',
        'characters': 'Caract√®res',
        'lines': 'Lignes',
        'session': 'Session',
        'current-project': 'Projet Actuel',
        'close': 'Fermer',
        'share': 'Partager'
      },
      hi: {
        'free-access': '‡§Æ‡•Å‡§´‡•ç‡§§ ‡§™‡§π‡•Å‡§Ç‡§ö',
        'to-all-premium': '‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§ì‡§Ç ‡§§‡§ï',
        'tagline': '‡§Ö‡§Ç‡§§‡§∞‡•ç‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Ø ‡§ó‡•Ä‡§§ ‡§≤‡•á‡§ñ‡§® ‡§∏‡•ç‡§ü‡•Ç‡§°‡§ø‡§Ø‡•ã',
        'writing-mode': '‚úèÔ∏è ‡§≤‡•á‡§ñ‡§® ‡§Æ‡•ã‡§°',
        'ai-assistant': 'AI ‡§∏‡§π‡§æ‡§Ø‡§ï',
        'ai-loading': 'AI ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
        'get-suggestions': '‡§∏‡•Å‡§ù‡§æ‡§µ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
        'file': 'üìÅ ‡§´‡§æ‡§á‡§≤',
        'new-project': 'üÜï ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü',
        'save-txt': 'üíæ TXT ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç',
        'open-file': 'üìÇ ‡§´‡§æ‡§á‡§≤ ‡§ñ‡•ã‡§≤‡•á‡§Ç',
        'export-options': 'üìÑ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™',
        'undo': '‚Ü©Ô∏è ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡•á‡§Ç',
        'redo': '‚Ü™Ô∏è ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç',
        'search-placeholder': '‡§ñ‡•ã‡§ú‡•á‡§Ç...',
        'suggest-rhymes': 'üîé ‡§§‡•Å‡§ï‡§¨‡§Ç‡§¶‡•Ä ‡§∏‡•Å‡§ù‡§æ‡§è‡§Ç',
        'inspire-me': 'üí° ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§Ç',
        'voice-memo': 'üé§ ‡§µ‡•â‡§á‡§∏ ‡§Æ‡•á‡§Æ‡•ã',
        'rhyme-colors': 'üé® ‡§§‡•Å‡§ï‡§¨‡§Ç‡§¶‡•Ä ‡§∞‡§Ç‡§ó',
        'focus-mode': 'üéØ ‡§´‡•ã‡§ï‡§∏ ‡§Æ‡•ã‡§°',
        'sepia': 'üü§ ‡§∏‡•á‡§™‡§ø‡§Ø‡§æ',
        'settings': '‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
        'pad-placeholder': '‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•á ‡§ó‡•Ä‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç...',
        'words': '‡§∂‡§¨‡•ç‡§¶',
        'characters': '‡§Ö‡§ï‡•ç‡§∑‡§∞',
        'lines': '‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å',
        'session': '‡§∏‡§§‡•ç‡§∞',
        'current-project': '‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü',
        'close': '‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
        'share': '‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç'
      },
      ar: {
        'free-access': 'ŸàÿµŸàŸÑ ŸÖÿ¨ÿßŸÜŸä',
        'to-all-premium': 'ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿ≠ÿ™Ÿâ',
        'tagline': 'ÿßÿ≥ÿ™ŸàÿØŸäŸà ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ÿßŸÑÿØŸàŸÑŸä',
        'writing-mode': '‚úèÔ∏è Ÿàÿ∂ÿπ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©',
        'ai-assistant': 'ŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
        'ai-loading': 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä...',
        'get-suggestions': 'ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™',
        'file': 'üìÅ ŸÖŸÑŸÅ',
        'new-project': 'üÜï ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ',
        'save-txt': 'üíæ ÿ≠ŸÅÿ∏ ŸÉŸÄ TXT',
        'open-file': 'üìÇ ŸÅÿ™ÿ≠ ŸÖŸÑŸÅ',
        'export-options': 'üìÑ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿµÿØŸäÿ±',
        'undo': '‚Ü©Ô∏è ÿ™ÿ±ÿßÿ¨ÿπ',
        'redo': '‚Ü™Ô∏è ÿ•ÿπÿßÿØÿ©',
        'search-placeholder': 'ÿ®ÿ≠ÿ´...',
        'suggest-rhymes': 'üîé ÿßŸÇÿ™ÿ±ÿßÿ≠ ŸÇŸàÿßŸÅŸä',
        'inspire-me': 'üí° ÿ£ŸÑŸáŸÖŸÜŸä',
        'voice-memo': 'üé§ ŸÖÿ∞ŸÉÿ±ÿ© ÿµŸàÿ™Ÿäÿ©',
        'rhyme-colors': 'üé® ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÇÿßŸÅŸäÿ©',
        'focus-mode': 'üéØ Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤',
        'sepia': 'üü§ ÿ®ŸÜŸä ÿØÿßŸÉŸÜ',
        'settings': '‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
        'pad-placeholder': 'ÿßŸÉÿ™ÿ® ŸÉŸÑŸÖÿßÿ™ŸÉ ŸáŸÜÿß...',
        'words': 'ŸÉŸÑŸÖÿßÿ™',
        'characters': 'ÿ£ÿ≠ÿ±ŸÅ',
        'lines': 'ÿ£ÿ≥ÿ∑ÿ±',
        'session': 'ÿ¨ŸÑÿ≥ÿ©',
        'current-project': 'ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿßŸÑÿ≠ÿßŸÑŸä',
        'close': 'ÿ•ÿ∫ŸÑÿßŸÇ',
        'share': 'ŸÖÿ¥ÿßÿ±ŸÉÿ©'
      }
    };

    let currentLanguage = localStorage.getItem('language') || 'en';
    
    function changeLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('language', lang);
      
      // Update document attributes
      document.documentElement.lang = lang;
      document.body.lang = lang;
      
      // Set RTL for Arabic
      if (lang === 'ar') {
        document.dir = 'rtl';
      } else {
        document.dir = 'ltr';
      }
      
      updateTranslations();
    }
    
    function updateTranslations() {
      const elements = document.querySelectorAll('[data-i18n]');
      elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
          element.textContent = translations[currentLanguage][key];
        }
      });
      
      // Update placeholders
      const placeholders = document.querySelectorAll('[data-i18n-placeholder]');
      placeholders.forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
          element.placeholder = translations[currentLanguage][key];
        }
      });
    }

    // ===== PWA FUNCTIONALITY =====
    
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('pwaInstall').style.display = 'flex';
    });
    
    function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted PWA install');
          }
          deferredPrompt = null;
          document.getElementById('pwaInstall').style.display = 'none';
        });
      }
    }
    
    function dismissInstall() {
      document.getElementById('pwaInstall').style.display = 'none';
      localStorage.setItem('pwaInstallDismissed', 'true');
    }
    
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // ===== CONNECTION STATUS =====
    
    function updateConnectionStatus() {
      const statusEl = document.getElementById('connectionStatus');
      const textEl = document.getElementById('connectionText');
      
      if (navigator.onLine) {
        statusEl.className = 'connection-status online';
        textEl.textContent = translations[currentLanguage]['online-mode'] || 'üåê Connected to internet.';
        setTimeout(() => {
          statusEl.style.transform = 'translateY(-100%)';
        }, 2000);
      } else {
        statusEl.className = 'connection-status offline';
        textEl.textContent = translations[currentLanguage]['offline-mode'] || 'üì¥ You are offline. Changes saved locally.';
        statusEl.style.transform = 'translateY(0)';
      }
    }
    
    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);

    // ===== AI ASSISTANT =====
    
    function toggleAI() {
      const aiPanel = document.getElementById('aiAssistant');
      aiPanel.classList.toggle('active');
      
      if (aiPanel.classList.contains('active')) {
        generateAISuggestions();
      }
    }
    
    async function generateAISuggestions() {
      const suggestionsEl = document.getElementById('aiSuggestions');
      suggestionsEl.innerHTML = '<p>ü§ñ Generating AI suggestions...</p>';
      
      // Simulate AI API call
      setTimeout(() => {
        const suggestions = [
          {
            type: 'rhyme',
            text: 'Try rhyming with: heart ‚Üí art, start, part, smart',
            action: () => insertText(' heart')
          },
          {
            type: 'structure',
            text: 'Consider adding a bridge after the second chorus',
            action: () => insertTemplate('bridge')
          },
          {
            type: 'emotion',
            text: 'Current tone: Hopeful. Suggested words: shine, rise, dream',
            action: () => showEmotionalWords()
          }
        ];
        
        suggestionsEl.innerHTML = suggestions.map(s => 
          `<div class="ai-suggestion" onclick="(${s.action})()">${s.text}</div>`
        ).join('');
      }, 1500);
    }
    
    function insertText(text) {
      const pad = document.getElementById('pad');
      const pos = pad.selectionStart;
      const value = pad.value;
      pad.value = value.slice(0, pos) + text + value.slice(pos);
      pad.focus();
      pad.setSelectionRange(pos + text.length, pos + text.length);
    }

    // ===== ENHANCED EXPORT =====
    
    function showExportModal() {
      document.getElementById('exportModal').style.display = 'block';
    }
    
    function hideExportModal() {
      document.getElementById('exportModal').style.display = 'none';
    }
    
    function exportRTF() {
      const rtfContent = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}\\f0\\fs24 ${pad.value.replace(/\n/g, '\\par ')}}`;
      downloadFile(rtfContent, current + '.rtf', 'application/rtf');
    }
    
    function exportWord() {
      // Simplified DOCX export (would need proper library in production)
      const htmlContent = `<html><body><pre>${pad.value}</pre></body></html>`;
      downloadFile(htmlContent, current + '.html', 'text/html');
      alert('HTML file exported. You can open it in Word and save as DOCX.');
    }
    
    function shareToSocial() {
      if (navigator.share) {
        navigator.share({
          title: 'My Lyrics - ' + current,
          text: pad.value,
          url: window.location.href
        });
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(pad.value).then(() => {
          alert('Lyrics copied to clipboard! Share anywhere you like.');
        });
      }
    }
    
    function downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 100);
    }

    // ===== EXISTING FUNCTIONALITY (PRESERVED) =====
    
    const pad = document.getElementById('pad');
    const rhymes = document.getElementById('rhyme-suggestions');
    const searchBox = document.getElementById('searchBox');
    let projects = JSON.parse(localStorage.getItem('lyricProjects')) || {};
    let current = Object.keys(projects)[0] || 'Untitled';
    
    let sessionStartTime = Date.now();
    let isRecording = false;
    let mediaRecorder = null;
    let recordedChunks = [];
    let rhymeSchemeEnabled = false;
    let focusModeEnabled = false;
    let stats = JSON.parse(localStorage.getItem('lyricsStats')) || {
      totalWords: 0,
      dailyWords: {},
      streak: 0,
      lastWriteDate: null
    };
    
    let undoStack = [];
    let redoStack = [];
    
    function trackChange(value) {
      if (undoStack.length && value === undoStack[undoStack.length-1]) return;
      undoStack.push(value);
      if (undoStack.length > 200) undoStack.shift();
      redoStack = [];
    }

    // Enhanced keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 's':
            e.preventDefault();
            saveToFile();
            break;
          case 'n':
            e.preventDefault();
            newProject();
            break;
          case 'o':
            e.preventDefault();
            document.getElementById('fileInput').click();
            break;
          case 'p':
            e.preventDefault();
            showExportModal();
            break;
          case 'z':
            e.preventDefault();
            undo();
            break;
          case 'y':
            e.preventDefault();
            redo();
            break;
          case 'f':
            e.preventDefault();
            searchBox.focus();
            break;
          case 'd':
            e.preventDefault();
            document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', document.body.classList.contains('dark'));
            break;
          case ',':
            e.preventDefault();
            showSettings();
            break;
        }
      }
      
      if (e.key === 'F11') {
        e.preventDefault();
        toggleFocusMode();
      }
      
      if (e.key === 'Escape') {
        hideSettings();
        hideVoiceModal();
        hideExportModal();
        if (focusModeEnabled) toggleFocusMode();
      }
    });

    // Enhanced statistics tracking
    function updateStats() {
      const text = pad.value;
      const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
      const characters = text.length;
      const lines = text.split('\n').length;
      const sessionMinutes = Math.floor((Date.now() - sessionStartTime) / 60000);
      
      document.getElementById('current-file-name').textContent = current;
      document.getElementById('word-count').textContent = words;
      document.getElementById('char-count').textContent = characters;
      document.getElementById('line-count').textContent = lines;
      document.getElementById('session-time').textContent = sessionMinutes + 'm';
      
      const today = new Date().toDateString();
      if (!stats.dailyWords[today]) stats.dailyWords[today] = 0;
      stats.totalWords = words;
      
      localStorage.setItem('lyricsStats', JSON.stringify(stats));
    }

    // All other functions preserved from original (tab management, voice recording, etc.)
    function saveProjects() { 
      localStorage.setItem('lyricProjects', JSON.stringify(projects)); 
    }
    
    function updateTabs() {
      const tabs = document.getElementById('tabs');
      tabs.innerHTML = '';
      Object.keys(projects).forEach(name => {
        const div = document.createElement('div');
        div.className = 'tab' + (name === current ? ' active' : '');
        
        const icon = document.createElement('img');
        icon.className = 'tab-icon';
        icon.src = 'https://cdn-icons-png.flaticon.com/512/727/727299.png';
        icon.alt = 'Music Note';
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = name;
        nameSpan.style.cursor = 'text';
        nameSpan.onclick = (e) => {
          e.stopPropagation();
          const input = document.createElement('input');
          input.value = name;
          input.style.fontSize = '14px';
          input.style.width = '110px';
          input.onblur = () => renameProject(name, input.value);
          input.onkeydown = (e) => { if (e.key === 'Enter') input.blur(); };
          nameSpan.replaceWith(input);
          input.focus();
        };
        
        const close = document.createElement('span');
        close.className = 'close-btn';
        close.textContent = '√ó';
        close.onclick = (e) => { 
          e.stopPropagation(); 
          deleteProject(name); 
        };
        
        div.onclick = () => {
          projects[current] = pad.value;
          current = name;
          loadProject(name);
          saveProjects();
        };
        
        div.appendChild(icon);
        div.appendChild(nameSpan);
        div.appendChild(close);
        tabs.appendChild(div);
      });
    }
    
    function loadProject(name) {
      pad.value = projects[name] || '';
      updateTabs();
      trackChange(pad.value);
      updateStats();
    }
    
    function newProject() {
      const name = prompt('New project name:');
      if (name && !projects[name]) {
        projects[name] = '';
        current = name;
        loadProject(name);
        saveProjects();
      }
    }

    function saveToFile() {
      const blob = new Blob([pad.value], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = current + '.txt'; 
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 200);
    }
    
    function exportPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("courier");
        const lines = doc.splitTextToSize(pad.value, 180);
        doc.text(lines, 10, 10);
        doc.save(current + ".pdf");
      } catch (error) {
        alert("PDF export failed. Please try again.");
      }
    }

    function exportAllProjects() {
      const allData = { 
        projects, 
        stats, 
        settings: {
          language: currentLanguage,
          theme: document.body.classList.contains('dark') ? 'dark' : 'light'
        },
        exportDate: new Date().toISOString() 
      };
      downloadFile(JSON.stringify(allData, null, 2), 'LiLyrics_Backup_' + new Date().toISOString().slice(0,10) + '.json', 'application/json');
    }

    function toggleFocusMode() {
      focusModeEnabled = !focusModeEnabled;
      document.body.classList.toggle('focus-mode', focusModeEnabled);
      if (focusModeEnabled) {
        pad.focus();
        document.getElementById('focusModeToggle').style.display = 'block';
      } else {
        document.
