<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/14384/14384748.png">
  <title>LiLyrics</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');
    @font-face {
      font-family: 'Monotype Corsiva';
      src: url('https://fonts.cdnfonts.com/s/17869/MonotypeCorsiva.woff') format('woff');
    }
    
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: #fff;
      color: #222;
      transition: all 0.3s;
    }
    
    /* FULL PAGE DARK MODE */
    body.dark {
      background: #121212;
      color: #f9f9f9;
    }
    
    body.dark header {
      background: #1e1e1e;
      border-bottom: 1px solid #444;
    }
    
    body.dark .tagline {
      color: #aaa;
    }
    
    body.dark #tabs {
      background: #1e1e1e;
      border-bottom: 1px solid #444;
    }
    
    body.dark .tab {
      border-right: 1px solid #444;
      color: #f9f9f9;
    }
    
    body.dark .tab.active {
      background: #2d2d2d;
      border-bottom: 2px solid #4285f4;
    }
    
    body.dark #controls {
      background: #1e1e1e;
      border-bottom: 1px solid #444;
    }
    
    body.dark button,
    body.dark select,
    body.dark input[type="search"] {
      background: #2d2d2d;
      color: #f9f9f9;
      border: 1px solid #555;
    }
    
    body.dark button:hover,
    body.dark select:hover,
    body.dark input[type="search"]:hover {
      background: #3d3d3d;
    }
    
    body.dark button:active {
      background: #444;
    }
    
    body.dark #pad {
      background: #1f1f1f;
      color: #f9f9f9;
      border: 1px solid #444;
    }
    
    body.dark #rhymes {
      background: #1e1e1e;
      border-top: 1px solid #444;
      color: #ccc;
    }
    
    body.dark #darkToggle {
      color: #f9f9f9;
    }
    
    /* SEPIA MODE */
    body.sepia {
      background: #f4ecd8;
      color: #40352b;
    }
    
    body.sepia header {
      background: #f0e6d2;
      border-bottom: 1px solid #d4c4a8;
    }
    
    body.sepia #tabs {
      background: #f0e6d2;
      border-bottom: 1px solid #d4c4a8;
    }
    
    body.sepia .tab {
      border-right: 1px solid #d4c4a8;
    }
    
    body.sepia .tab.active {
      background: #f8f2e4;
    }
    
    body.sepia #controls {
      background: #f0e6d2;
      border-bottom: 1px solid #d4c4a8;
    }
    
    body.sepia button,
    body.sepia select,
    body.sepia input[type="search"] {
      background: #f8f2e4;
      color: #40352b;
      border: 1px solid #d4c4a8;
    }
    
    body.sepia #pad {
      background: #fbf6e6;
      color: #40352b;
      border: 1px solid #d4c4a8;
    }
    
    body.sepia #rhymes {
      background: #f0e6d2;
      border-top: 1px solid #d4c4a8;
      color: #40352b;
    }
    
    /* REGULAR STYLES */
    header {
      text-align: center;
      padding: 20px;
      background: #f9f9f9;
      border-bottom: 1px solid #ddd;
      position: relative;
    }
    
    .logo-line {
      font-family: 'Monotype Corsiva', cursive;
      font-size: 32px;
      font-weight: 700;
      color: #4285f4;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-line img {
      width: 30px;
      height: 30px;
      margin-right: 10px;
    }
    
    .tagline {
      font-size: 14px;
      color: #555;
      margin-top: 4px;
    }
    
    #darkToggle {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    #tabs {
      display: flex;
      flex-wrap: wrap;
      background: #f7f7f7;
      border-bottom: 1px solid #ccc;
      padding: 0 10px;
    }
    
    .tab {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      cursor: pointer;
      border-right: 1px solid #ccc;
    }
    
    .tab.active {
      background: #fff;
      border-bottom: 2px solid #4285f4;
      font-weight: bold;
    }
    
    .tab .tab-icon {
      margin-right: 6px;
      color: #4285f4;
    }
    
    .tab .close-btn {
      margin-left: 8px;
      color: red;
      font-weight: bold;
      cursor: pointer;
    }
    
    #controls {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
      flex-wrap: wrap;
      align-items: center;
    }
    
    button, select, input[type="search"] {
      padding: 6px 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #f5f5f5;
    }
    
    button:active {
      background: #eee;
    }
    
    #pad {
      width: 100%;
      height: 60vh;
      padding: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 16px;
      line-height: 1.6;
      border: none;
      outline: none;
      resize: none;
      box-sizing: border-box;
      background: #fff;
      color: #000;
    }
    
    #rhymes {
      padding: 15px 20px;
      font-size: 14px;
      background: #f2f2f2;
      border-top: 1px solid #ccc;
      color: #333;
      min-height: 40px;
    }
    
    @media (max-width: 600px) {
      #pad {
        height: 50vh;
        font-size: 15px;
      }
      #controls {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header>
    <div class="logo-line">
      <img src="https://cdn-icons-png.flaticon.com/512/14384/14384748.png" alt="Lyrics Icon"/>
      LiLyrics
    </div>
    <div class="tagline">most powerful lyric pad...</div>
    <button id="darkToggle" title="Toggle dark mode">üåô</button>
  </header>
  
  <div id="tabs"></div>
  
  <div id="controls">
    <button onclick="newProject()">üÜï New</button>
    <button onclick="saveToFile()">üíæ Save</button>
    <button onclick="document.getElementById('fileInput').click()">üìÇ Open</button>
    <button onclick="shareLyrics()">üì§ Share</button>
    <button onclick="undo()">‚Ü©Ô∏è Undo</button>
    <button onclick="redo()">‚Ü™Ô∏è Redo</button>
    <button onclick="exportPDF()">üìÑ Export PDF</button>
    <select id="fontSelect" onchange="changeFont()">
      <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
      <option value="'Courier Prime', monospace">Courier Prime</option>
      <option value="'Fira Code', monospace">Fira Code</option>
      <option value="monospace">Default Monospace</option>
    </select>
    <input type="search" id="searchBox" placeholder="Search...">
    <input type="file" id="fileInput" style="display:none" accept=".txt" onchange="loadFromFile(event)"/>
    <select id="rhymeLang">
      <option value="english">English</option>
      <option value="hindi">Hindi (Eng Script)</option>
      <option value="urdu">Urdu (Eng Script)</option>
    </select>
    <button onclick="promptSuggestRhymes()">üîé Suggest Rhymes</button>
    <button onclick="showPrompt()">üí° Inspire Me</button>
    <button onclick="toggleSepia()">üü§ Sepia</button>
  </div>
  
  <textarea id="pad" placeholder="Write your lyrics here..."></textarea>
  <div id="rhymes"></div>

  <script>
    // ---------- DATA & STATE ----------
    const pad = document.getElementById('pad');
    const rhymes = document.getElementById('rhymes');
    const searchBox = document.getElementById('searchBox');
    let projects = JSON.parse(localStorage.getItem('lyricProjects')) || {};
    let current = Object.keys(projects)[0] || 'Untitled';

    // --- Undo/Redo stacks ---
    let undoStack = [];
    let redoStack = [];
    
    function trackChange(value) {
      if (undoStack.length && value === undoStack[undoStack.length-1]) return;
      undoStack.push(value);
      if (undoStack.length > 200) undoStack.shift(); // limit stack
      redoStack = [];
    }

    // ------------- TABS & PROJECTS -------------
    function saveProjects() { 
      localStorage.setItem('lyricProjects', JSON.stringify(projects)); 
    }
    
    function updateTabs() {
      const tabs = document.getElementById('tabs');
      tabs.innerHTML = '';
      Object.keys(projects).forEach(name => {
        const div = document.createElement('div');
        div.className = 'tab' + (name === current ? ' active' : '');
        
        const icon = document.createElement('span');
        icon.className = 'tab-icon';
        icon.textContent = 'üéµ';
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = name;
        nameSpan.style.cursor = 'text';
        nameSpan.onclick = (e) => {
          e.stopPropagation();
          const input = document.createElement('input');
          input.value = name;
          input.style.fontSize = '14px';
          input.style.width = '110px';
          input.onblur = () => renameProject(name, input.value);
          input.onkeydown = (e) => { if (e.key === 'Enter') input.blur(); };
          nameSpan.replaceWith(input);
          input.focus();
        };
        
        const close = document.createElement('span');
        close.className = 'close-btn';
        close.textContent = '√ó';
        close.onclick = (e) => { 
          e.stopPropagation(); 
          deleteProject(name); 
        };
        
        div.onclick = () => {
          projects[current] = pad.value;
          current = name;
          loadProject(name);
          saveProjects();
        };
        
        div.appendChild(icon);
        div.appendChild(nameSpan);
        div.appendChild(close);
        tabs.appendChild(div);
      });
    }
    
    function renameProject(oldName, newName) {
      if (!newName || newName === oldName || projects[newName]) { 
        updateTabs(); 
        return; 
      }
      projects[newName] = projects[oldName]; 
      delete projects[oldName];
      if (current === oldName) current = newName;
      saveProjects(); 
      loadProject(newName);
    }
    
    function deleteProject(name) {
      if (!confirm(`Delete "${name}"?`)) return;
      delete projects[name];
      current = name === current ? Object.keys(projects)[0] || 'Untitled' : current;
      if (!projects[current]) projects[current] = '';
      loadProject(current);
      saveProjects();
      updateTabs();
    }
    
    function loadProject(name) {
      pad.value = projects[name] || '';
      updateTabs();
      trackChange(pad.value);
    }
    
    function newProject() {
      const name = prompt('New project name:');
      if (name && !projects[name]) {
        projects[name] = '';
        current = name;
        loadProject(name);
        saveProjects();
      }
    }

    // ---------- FILES & EXPORT ----------
    function saveToFile() {
      const blob = new Blob([pad.value], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = current + '.txt'; 
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 200);
    }
    
    function loadFromFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const name = file.name.replace('.txt', '');
        projects[name] = reader.result;
        current = name;
        loadProject(name);
        saveProjects();
      };
      reader.readAsText(file);
    }
    
    function shareLyrics() {
      const text = pad.value.trim();
      if (!text) { 
        alert('Lyrics are empty.'); 
        return; 
      }
      navigator.clipboard.writeText(text)
        .then(() => alert('Lyrics copied to clipboard. Paste & share anywhere!'))
        .catch(() => alert('Failed to copy lyrics.'));
    }

    // ---------- FONT, SEARCH & THEME ----------
    function changeFont() {
      const font = document.getElementById('fontSelect').value;
      pad.style.fontFamily = font;
    }
    
    searchBox.oninput = () => {
      const query = searchBox.value.trim().toLowerCase();
      const content = pad.value;
      if (query && content.toLowerCase().includes(query)) {
        rhymes.innerHTML = `"${query}" found in lyrics.`;
      } else if (query) {
        rhymes.innerHTML = "No match.";
      } else {
        rhymes.innerHTML = "";
      }
    };
    
    document.getElementById('darkToggle').onclick = function() {
      document.body.classList.toggle('dark');
      // Save dark mode preference
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    };
    
    function toggleSepia() {
      document.body.classList.toggle('sepia');
      // Save sepia mode preference
      localStorage.setItem('sepiaMode', document.body.classList.contains('sepia'));
    }

    // ---------- RHYME SUGGESTION ----------
    function promptSuggestRhymes() {
      const lang = document.getElementById('rhymeLang').value;
      const line = prompt('Type a lyric line to suggest rhymes for:');
      if (!line) return;
      
      rhymes.textContent = "Thinking...";
      
      // Mock rhyme suggestions (replace with your API call)
      setTimeout(() => {
        const mockRhymes = {
          english: ["time, rhyme, climb", "love, dove, above", "night, light, sight"],
          hindi: ["dil, mil, khil", "raat, baat, saath", "sapna, apna, mann"],
          urdu: ["ishq, rishq, vishq", "dard, mard, yard", "mohabbat, hasrat, qayamat"]
        };
        const suggestions = mockRhymes[lang] || mockRhymes.english;
        const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
        rhymes.textContent = "Rhymes: " + randomSuggestion;
      }, 1000);
    }

    // ---------- INSPIRATION PROMPT ----------
    const prompts = [
      "Write a verse about a sleepless city night.",
      "Begin a chorus with the word 'freedom.'",
      "Describe rain using only metaphors.",
      "Write a line with the word 'khoobsurat' (beautiful) in it.",
      "Combine Hindi & English in a couplet.",
      "Imagine a duet between two moods.",
      "Write about a memory that feels like a song.",
      "Create a verse about digital love."
    ];
    
    function showPrompt() {
      alert(prompts[Math.floor(Math.random() * prompts.length)]);
    }

    // ---------- PDF EXPORT ----------
    function exportPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("courier");
        const lines = doc.splitTextToSize(pad.value, 180);
        doc.text(lines, 10, 10);
        doc.save(current + ".pdf");
      } catch (error) {
        alert("PDF export failed. Please try again.");
      }
    }

    // ---------- UNDO / REDO ----------
    function undo() {
      if (undoStack.length < 2) return;
      redoStack.push(undoStack.pop());
      const prev = undoStack[undoStack.length - 1];
      pad.value = prev;
      projects[current] = prev;
      saveProjects();
    }
    
    function redo() {
      if (!redoStack.length) return;
      const next = redoStack.pop();
      undoStack.push(next);
      pad.value = next;
      projects[current] = next;
      saveProjects();
    }

    // ---------- MAIN TEXTAREA EVENTS ----------
    pad.oninput = (e) => {
      projects[current] = e.target.value;
      saveProjects();
      trackChange(e.target.value);
    };

    // ---------- INITIALIZATION ----------
    if (!projects[current]) projects[current] = '';
    loadProject(current);
    updateTabs();
    
    // Load saved theme preferences
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
    }
    if (localStorage.getItem('sepiaMode') === 'true') {
      document.body.classList.add('sepia');
    }
  </script>
</body>
</html>
