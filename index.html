<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/14384/14384748.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>LiLyrics v2.3 Pro - Professional Songwriting Studio</title>
  <style>
    /* Updated Font Imports */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Verdana&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Arial&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Times+New+Roman&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Georgia&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap');
    @font-face {
      font-family: 'Monotype Corsiva';
      src: url('https://fonts.cdnfonts.com/s/17869/MonotypeCorsiva.woff') format('woff');
    }
    @font-face {
      font-family: 'V-Hand';
      src: url('https://fonts.cdnfonts.com/css/v-hand') format('woff2'),
           url('https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap') format('woff');
      fallback: 'Reenie Beanie', cursive;
    }
    
    :root {
      --primary-color: #4285f4;
      --secondary-color: #34a853;
      --error-color: #ea4335;
      --warning-color: #fbbc04;
      --surface-color: #ffffff;
      --background-color: #fafafa;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --border-color: #dadce0;
      --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-elevated: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
      --logo-color: #ff6b35; /* Logo image color */
    }
    
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif !important;
      background: var(--background-color);
      color: var(--text-primary);
      transition: all 0.3s ease;
      line-height: 1.5;
      font-weight: 400;
    }
    
    /* Enhanced animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes glow {
      from { box-shadow: 0 0 20px rgba(66, 133, 244, 0.3); }
      to { box-shadow: 0 0 30px rgba(66, 133, 244, 0.6); }
    }
    
    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    /* LOGIN/SIGNUP MODAL */
    .auth-modal {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 3000;
      align-items: center;
      justify-content: center;
    }
    
    .auth-container {
      background: var(--surface-color);
      padding: 40px;
      border-radius: 16px;
      width: 90%;
      max-width: 450px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: fadeIn 0.5s ease;
    }
    
    .auth-title {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .auth-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 32px;
    }
    
    .auth-tabs {
      display: flex;
      margin-bottom: 24px;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 4px;
    }
    
    .auth-tab {
      flex: 1;
      padding: 12px 20px;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    .auth-tab.active {
      background: var(--primary-color);
      color: white;
    }
    
    .auth-form {
      display: none;
    }
    
    .auth-form.active {
      display: block;
    }
    
    .auth-input {
      width: 100%;
      padding: 14px 16px;
      margin: 12px 0;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Montserrat', sans-serif;
      outline: none;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }
    
    .auth-input:focus {
      border-color: var(--primary-color);
    }
    
    .auth-btn {
      width: 100%;
      padding: 14px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 16px 0;
      transition: background 0.2s ease;
    }
    
    .auth-btn:hover {
      background: #3367d6;
    }
    
    .social-login {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .social-btn {
      padding: 12px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 500;
    }
    
    .social-btn:hover {
      border-color: var(--primary-color);
      background: rgba(66, 133, 244, 0.04);
    }
    
    .google-btn {
      color: #4285f4;
    }
    
    .github-btn {
      color: #333;
    }
    
    /* Payment Modal */
    .payment-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      backdrop-filter: blur(8px);
    }
    
    .payment-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface-color);
      padding: 40px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }
    
    .payment-title {
      color: var(--primary-color);
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    
    .payment-price {
      font-size: 48px;
      font-weight: 800;
      color: var(--secondary-color);
      margin: 20px 0;
    }
    
    .qr-code {
      width: 200px;
      height: 200px;
      margin: 20px auto;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8f9fa;
    }
    
    .payment-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .payment-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .payment-btn.upi {
      background: #00d4aa;
      color: white;
    }
    
    .payment-btn.gpay {
      background: #4285f4;
      color: white;
    }
    
    .payment-btn.paytm {
      background: #00baf2;
      color: white;
    }
    
    .payment-btn.phonepe {
      background: #5f259f;
      color: white;
    }
    
    .payment-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-elevated);
    }
    
    /* FREE PROMO BANNER */
    .promo-banner {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      text-align: center;
      padding: 16px;
      font-weight: 500;
      animation: glow 2s ease-in-out infinite alternate;
      position: relative;
      overflow: hidden;
    }
    
    .promo-banner.expired {
      background: linear-gradient(135deg, #ff6b6b, #ffa726);
    }
    
    .promo-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 3s infinite;
    }
    
    .promo-text {
      position: relative;
      z-index: 1;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .promo-highlight {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }
    
    /* Enhanced Header */
    header {
      text-align: center;
      padding: 24px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      position: relative;
      box-shadow: var(--shadow);
    }
    
    /* UPDATED: Logo with matching image color and v2.3 Pro badge */
    .logo-line {
      font-family: 'Monotype Corsiva', cursive !important;
      font-size: 36px;
      font-weight: 700;
      color: var(--logo-color) !important;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      animation: fadeIn 0.6s ease;
      position: relative;
    }
    
    .logo-line img {
      width: 32px;
      height: 32px;
      animation: pulse 2s infinite;
      filter: hue-rotate(0deg) brightness(1) contrast(1);
    }
    
    .version-pro {
      position: absolute;
      right: -60px;
      top: -5px;
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      font-family: 'Montserrat', sans-serif;
      box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
      animation: pulse 3s infinite;
    }
    
    .tagline {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 8px;
      font-weight: 400;
    }
    
    .user-info {
      position: absolute;
      top: 15px;
      left: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }
    
    .logout-btn {
      background: none;
      border: none;
      color: var(--error-color);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    
    .logout-btn:hover {
      background: rgba(234, 67, 53, 0.1);
    }
    
    #darkToggle {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    
    #darkToggle:hover {
      background: rgba(0,0,0,0.1);
    }
    
    /* ENHANCED: Tab system with New Project button */
    #tabs-container {
      display: flex;
      align-items: center;
      background: var(--surface-color);
      border-bottom: 2px solid var(--primary-color);
      padding: 0 16px;
      box-shadow: var(--shadow);
      margin: 8px 0;
      border-radius: 8px 8px 0 0;
    }
    
    #tabs {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: hidden;
      white-space: nowrap;
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) transparent;
      flex: 1;
    }
    
    #tabs::-webkit-scrollbar {
      height: 6px;
    }
    
    #tabs::-webkit-scrollbar-track {
      background: transparent;
    }
    
    #tabs::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }
    
    .tab {
      display: inline-flex;
      align-items: center;
      padding: 14px 18px;
      cursor: pointer;
      border-right: 1px solid var(--border-color);
      flex-shrink: 0;
      min-width: max-content;
      white-space: nowrap;
      transition: all 0.3s ease;
      position: relative;
      margin: 4px 2px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.7);
    }
    
    .tab:hover {
      background: rgba(66, 133, 244, 0.08);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(66, 133, 244, 0.15);
    }
    
    .tab.active {
      background: linear-gradient(135deg, rgba(66, 133, 244, 0.1), rgba(52, 168, 83, 0.1));
      border-bottom: 3px solid var(--secondary-color);
      font-weight: 600;
      color: var(--primary-color);
      box-shadow: 0 3px 12px rgba(66, 133, 244, 0.2);
    }
    
    .tab .tab-icon {
      margin-right: 8px;
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      opacity: 0.8;
    }
    
    .tab .close-btn {
      margin-left: 8px;
      color: var(--error-color);
      font-weight: bold;
      cursor: pointer;
      flex-shrink: 0;
      padding: 2px 6px;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    
    .tab .close-btn:hover {
      background: rgba(234, 67, 53, 0.1);
    }
    
    /* NEW PROJECT BUTTON */
    .new-project-btn {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      margin-left: 16px;
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
    }
    
    .new-project-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-elevated);
    }
    
    /* Enhanced Controls */
    #controls {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      flex-wrap: wrap;
      align-items: center;
      box-shadow: var(--shadow);
    }
    
    button, select, input[type="search"] {
      padding: 8px 16px;
      font-size: 14px;
      font-family: 'Montserrat', sans-serif !important;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--surface-color);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    button:hover {
      background: rgba(66, 133, 244, 0.04);
      border-color: var(--primary-color);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    
    button.hidden {
      display: none;
    }
    
    /* Enhanced Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background: var(--surface-color);
      min-width: 180px;
      box-shadow: var(--shadow-elevated);
      z-index: 10;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      top: 100%;
      left: 0;
      overflow: hidden;
      animation: fadeIn 0.2s ease;
    }
    
    .dropdown-content button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
      margin: 0;
      padding: 12px 16px;
      background: var(--surface-color);
      color: var(--text-primary);
      transition: background 0.2s ease;
    }
    
    .dropdown-content button:hover {
      background: rgba(66, 133, 244, 0.04);
      transform: none;
    }
    
    .dropdown:hover .dropdown-content {
      display: block;
    }
    
    /* FIXED: Textarea (lyrics) font system */
    #pad {
      width: 100%;
      height: 60vh;
      padding: 24px;
      font-size: 20px !important;
      line-height: 1.8 !important;
      letter-spacing: 0.5px;
      border: none;
      outline: none;
      resize: none;
      box-sizing: border-box;
      background: var(--surface-color);
      color: var(--text-primary);
      position: relative;
      border-top: 1px solid var(--border-color);
      /* Default font will be set by JavaScript */
    }
    
    #pad:focus {
      background: #fafbff;
      box-shadow: inset 0 2px 4px rgba(66, 133, 244, 0.1);
    }
    
    /* Empty state when no tabs */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 60vh;
      background: var(--surface-color);
      color: var(--text-secondary);
      text-align: center;
      padding: 40px;
    }
    
    .empty-state i {
      font-size: 64px;
      color: var(--border-color);
      margin-bottom: 24px;
    }
    
    .empty-state h3 {
      margin: 0 0 16px 0;
      color: var(--text-primary);
    }
    
    .empty-state p {
      margin: 0;
      max-width: 400px;
    }
    
    /* Enhanced Statistics */
    #rhymes {
      padding: 20px 24px;
      font-size: 14px;
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
      color: var(--text-secondary);
      min-height: 60px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 16px;
      box-shadow: var(--shadow);
    }
    
    #stats-mini {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
      min-width: 300px;
    }
    
    .stat-item {
      text-align: center;
      padding: 8px;
      background: rgba(66, 133, 244, 0.04);
      border-radius: 8px;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    /* Enhanced Focus Mode */
    #focusModeToggle {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 999;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: var(--shadow-elevated);
      transition: all 0.3s ease;
      display: none;
    }
    
    body.focus-mode #focusModeToggle {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* Enhanced Modals */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface-color);
      padding: 32px;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      animation: fadeIn 0.3s ease;
    }
    
    /* Enhanced Settings Tabs */
    .settings-tabs {
      display: flex;
      margin-bottom: 24px;
      border-bottom: 2px solid var(--border-color);
      flex-wrap: wrap;
      gap: 4px;
    }
    
    .settings-tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      flex-shrink: 0;
      transition: all 0.2s ease;
      border-radius: 6px 6px 0 0;
      font-weight: 500;
    }
    
    .settings-tab:hover {
      background: rgba(66, 133, 244, 0.04);
    }
    
    .settings-tab.active {
      border-bottom-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(66, 133, 244, 0.04);
    }
    
    .settings-panel {
      display: none;
    }
    
    .settings-panel.active {
      display: block;
    }
    
    /* Button customization panel */
    .button-toggle {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    
    .button-toggle label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: rgba(66, 133, 244, 0.04);
      border-radius: 6px;
      cursor: pointer;
    }
    
    /* ENHANCED: AI Processing Indicator */
    .ai-processing {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      font-size: 13px;
      animation: pulse 2s infinite;
    }
    
    .ai-processing::before {
      content: "üß†";
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }
    
    /* Dark Mode */
    body.dark {
      --surface-color: #1f1f1f;
      --background-color: #121212;
      --text-primary: #e8eaed;
      --text-secondary: #9aa0a6;
      --border-color: #3c4043;
    }
    
    /* Sepia Mode */
    body.sepia {
      --surface-color: #f8f2e4;
      --background-color: #f4ecd8;
      --text-primary: #40352b;
      --text-secondary: #6b5d50;
      --border-color: #d4c4a8;
      --primary-color: #8B4513;
    }
    
    /* Focus Mode */
    body.focus-mode #controls,
    body.focus-mode #tabs-container,
    body.focus-mode header,
    body.focus-mode #rhymes,
    body.focus-mode .promo-banner {
      display: none;
    }
    
    body.focus-mode #pad {
      height: 100vh;
      border: none;
    }
    
    body.focus-mode .empty-state {
      height: 100vh;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .auth-container {
        padding: 20px;
        width: 95%;
      }
      
      .social-login {
        grid-template-columns: 1fr;
      }
      
      .payment-content {
        padding: 20px;
      }
      
      .payment-methods {
        grid-template-columns: 1fr;
      }
      
      #controls {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
      
      #pad {
        font-size: 18px !important;
      }
      
      .logo-line {
        font-size: 28px;
      }
      
      .version-pro {
        right: -50px;
        font-size: 10px;
        padding: 3px 8px;
      }
      
      .user-info {
        flex-direction: column;
        gap: 4px;
        font-size: 11px;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
</head>
<body>
  <!-- LOGIN/SIGNUP MODAL -->
  <div id="authModal" class="auth-modal">
    <div class="auth-container">
      <div class="auth-title">Welcome to LiLyrics</div>
      <div class="auth-subtitle">Professional Songwriting Studio</div>
      
      <div class="auth-tabs">
        <div class="auth-tab active" onclick="showAuthTab('login')">Login</div>
        <div class="auth-tab" onclick="showAuthTab('signup')">Sign Up</div>
      </div>
      
      <!-- Login Form -->
      <div id="loginForm" class="auth-form active">
        <input type="email" id="loginEmail" class="auth-input" placeholder="Email address" required>
        <input type="password" id="loginPassword" class="auth-input" placeholder="Password" required>
        <button class="auth-btn" onclick="handleLogin()">
          <i class="fas fa-sign-in-alt"></i> Login to LiLyrics
        </button>
      </div>
      
      <!-- Signup Form -->
      <div id="signupForm" class="auth-form">
        <input type="text" id="signupName" class="auth-input" placeholder="Full Name" required>
        <input type="email" id="signupEmail" class="auth-input" placeholder="Email address" required>
        <input type="password" id="signupPassword" class="auth-input" placeholder="Create Password" required>
        <input type="password" id="signupConfirm" class="auth-input" placeholder="Confirm Password" required>
        <button class="auth-btn" onclick="handleSignup()">
          <i class="fas fa-user-plus"></i> Create Account
        </button>
      </div>
      
      <div style="margin: 20px 0; color: var(--text-secondary); font-size: 13px;">or continue with</div>
      
      <div class="social-login">
        <div class="social-btn google-btn" onclick="loginWithGoogle()">
          <i class="fab fa-google"></i> Google
        </div>
        <div class="social-btn github-btn" onclick="loginWithGitHub()">
          <i class="fab fa-github"></i> GitHub
        </div>
      </div>
      
      <div style="margin-top: 24px; font-size: 12px; color: var(--text-secondary);">
        <i class="fas fa-cloud"></i> Your lyrics will be safely stored in the cloud and synced across all devices
      </div>
    </div>
  </div>

  <!-- PROMO BANNER -->
  <div id="promoBanner" class="promo-banner">
    <div class="promo-text">
      <i class="fas fa-gift"></i>
      <span class="promo-highlight">FREE ACCESS</span>
      <span>to ALL Premium Features until</span>
      <span class="promo-highlight">December 31, 2025!</span>
      <i class="fas fa-music"></i>
    </div>
  </div>

  <!-- PAYMENT MODAL -->
  <div id="paymentModal" class="payment-modal">
    <div class="payment-content">
      <div class="payment-title">
        <i class="fas fa-crown"></i> Upgrade to Lifetime Access
      </div>
      <div class="payment-price">‚Çπ199</div>
      <p>One-time payment for lifetime access to all premium features!</p>
      
      <div class="qr-code" id="qrCode">
        <i class="fas fa-qrcode" style="font-size: 48px; color: #ccc;"></i>
      </div>
      
      <div class="payment-methods">
        <button class="payment-btn upi" onclick="payWithUPI()">
          <i class="fab fa-google-pay"></i> UPI Pay
        </button>
        <button class="payment-btn gpay" onclick="payWithGPay()">
          <i class="fab fa-google-pay"></i> Google Pay
        </button>
        <button class="payment-btn paytm" onclick="payWithPaytm()">
          <i class="fas fa-mobile-alt"></i> Paytm
        </button>
        <button class="payment-btn phonepe" onclick="payWithPhonePe()">
          <i class="fas fa-phone"></i> PhonePe
        </button>
      </div>
      
      <div style="margin: 20px 0; padding: 16px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid var(--primary-color);">
        <strong>UPI ID:</strong> lilaanas6-3@okicici<br>
        <strong>Amount:</strong> ‚Çπ199<br>
        <strong>Note:</strong> LiLyrics Lifetime Access
      </div>
      
      <button onclick="hidePaymentModal()" style="background: #666; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 16px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <header>
    <!-- User Info -->
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">U</div>
      <div>
        <div id="userName">User Name</div>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
    
    <!-- UPDATED: Logo with matching color and v2.3 Pro badge -->
    <div class="logo-line">
      <img src="https://cdn-icons-png.flaticon.com/512/14384/14384748.png" alt="Lyrics Icon"/>
      <span>LiLyrics</span>
      <div class="version-pro">v2.3 Pro</div>
    </div>
    <div class="tagline">Professional Songwriting Studio</div>
    <button id="darkToggle" title="Toggle dark mode"><i class="fas fa-moon"></i></button>
  </header>
  
  <!-- UPDATED: Tab container with New Project button -->
  <div id="tabs-container">
    <div id="tabs"></div>
    <button class="new-project-btn" onclick="newProject()">
      <i class="fas fa-plus"></i> New Project
    </button>
  </div>
  
  <!-- Focus Mode Toggle Button -->
  <button id="focusModeToggle" onclick="toggleFocusMode()" title="Exit Focus Mode">
    <i class="fas fa-edit"></i> Writing Mode
  </button>
  
  <div id="controls">
    <!-- File Dropdown (removed New Project button) -->
    <div class="dropdown" id="fileDropdown">
      <button><i class="fas fa-folder"></i> File</button>
      <div class="dropdown-content">
        <button onclick="saveToFile()"><i class="fas fa-save"></i> Save as TXT</button>
        <button onclick="document.getElementById('fileInput').click()"><i class="fas fa-folder-open"></i> Open File</button>
        <button onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
      </div>
    </div>
    
    <button id="undoBtn" onclick="undo()"><i class="fas fa-undo"></i> Undo</button>
    <button id="redoBtn" onclick="redo()"><i class="fas fa-redo"></i> Redo</button>
    
    <!-- FIXED: Font selector with proper implementation -->
    <select id="fontSelect" onchange="changeFont()">
      <option value="V-Hand" selected>V-Hand (Default)</option>
      <option value="Verdana">Verdana</option>
      <option value="Arial">Arial</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Georgia">Georgia</option>
      <option value="JetBrains Mono">JetBrains Mono</option>
      <option value="Courier Prime">Courier Prime</option>
      <option value="Reenie Beanie">Reenie Beanie</option>
    </select>
    
    <input type="search" id="searchBox" placeholder="Search...">
    <input type="file" id="fileInput" style="display:none" accept=".txt,.json" onchange="loadFromFile(event)"/>
    
    <button id="rhymeBtn" onclick="promptSuggestRhymes()"><i class="fas fa-search"></i> AI Mega Rhymes</button>
    <button id="inspireBtn" onclick="showInspireModal()"><i class="fas fa-lightbulb"></i> Inspire Me</button>
    <button id="voiceBtn" onclick="toggleVoiceRecording()"><i class="fas fa-microphone"></i> Voice Memo</button>
    <button id="rhymeColorsBtn" onclick="toggleRhymeScheme()"><i class="fas fa-palette"></i> Rhyme Colors</button>
    <button id="focusBtn" onclick="toggleFocusMode()"><i class="fas fa-bullseye"></i> Focus Mode</button>
    <button id="sepiaBtn" onclick="toggleSepia()"><i class="fas fa-adjust"></i> Sepia</button>
    <button id="settingsBtn" onclick="showSettings()"><i class="fas fa-cog"></i> Settings</button>
  </div>
  
  <!-- MAIN CONTENT AREA -->
  <div id="mainContent">
    <!-- This will show either the textarea or empty state -->
  </div>
  
  <div id="rhymes">
    <div id="rhyme-suggestions"></div>
    <div id="stats-mini">
      <div class="stat-item">
        <div class="stat-value" id="word-count">0</div>
        <div class="stat-label">Words</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="char-count">0</div>
        <div class="stat-label">Characters</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="line-count">0</div>
        <div class="stat-label">Lines</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="session-time">0m</div>
        <div class="stat-label">Session</div>
      </div>
      <div class="stat-item" style="grid-column: span 2;">
        <div class="stat-value" id="current-file-name">No Project</div>
        <div class="stat-label">Current Project</div>
      </div>
    </div>
  </div>

  <!-- Inspire Modal -->
  <div id="inspireModal" class="modal">
    <div class="modal-content">
      <h2><i class="fas fa-lightbulb"></i> Creative Inspiration (1000+ Prompts)</h2>
      <div id="inspireContent" style="max-height: 400px; overflow-y: auto; padding: 16px; background: #f8f9fa; border-radius: 8px; margin: 16px 0;">
        Loading inspiration...
      </div>
      <button onclick="getNewInspiration()" style="background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 8px;">
        <i class="fas fa-sync"></i> New Inspiration
      </button>
      <button onclick="hideInspireModal()" style="background: #666; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 8px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="settings-tabs">
        <div class="settings-tab active" onclick="showSettingsTab('interface')"><i class="fas fa-desktop"></i> Interface</div>
        <div class="settings-tab" onclick="showSettingsTab('shortcuts')"><i class="fas fa-keyboard"></i> Shortcuts</div>
        <div class="settings-tab" onclick="showSettingsTab('stats')"><i class="fas fa-chart-bar"></i> Statistics</div>
        <div class="settings-tab" onclick="showSettingsTab('templates')"><i class="fas fa-file-alt"></i> Templates</div>
        <div class="settings-tab" onclick="showSettingsTab('advanced')"><i class="fas fa-cogs"></i> Advanced</div>
        <div class="settings-tab" onclick="showSettingsTab('about')"><i class="fas fa-info-circle"></i> About</div>
      </div>
      
      <!-- Interface Panel -->
      <div id="interface-panel" class="settings-panel active">
        <h3><i class="fas fa-desktop"></i> Customize Interface</h3>
        <p>Show/Hide buttons to customize your workspace:</p>
        <div class="button-toggle">
          <label>
            <input type="checkbox" id="toggle-undo" checked onchange="toggleButton('undoBtn', this.checked)">
            <i class="fas fa-undo"></i> Undo/Redo Buttons
          </label>
          <label>
            <input type="checkbox" id="toggle-voice" checked onchange="toggleButton('voiceBtn', this.checked)">
            <i class="fas fa-microphone"></i> Voice Memo
          </label>
          <label>
            <input type="checkbox" id="toggle-rhyme" checked onchange="toggleButton('rhymeBtn', this.checked)">
            <i class="fas fa-search"></i> AI Mega Rhymes
          </label>
          <label>
            <input type="checkbox" id="toggle-inspire" checked onchange="toggleButton('inspireBtn', this.checked)">
            <i class="fas fa-lightbulb"></i> Inspiration
          </label>
          <label>
            <input type="checkbox" id="toggle-colors" checked onchange="toggleButton('rhymeColorsBtn', this.checked)">
            <i class="fas fa-palette"></i> Rhyme Colors
          </label>
          <label>
            <input type="checkbox" id="toggle-focus" checked onchange="toggleButton('focusBtn', this.checked)">
            <i class="fas fa-bullseye"></i> Focus Mode
          </label>
          <label>
            <input type="checkbox" id="toggle-sepia" checked onchange="toggleButton('sepiaBtn', this.checked)">
            <i class="fas fa-adjust"></i> Sepia Mode
          </label>
        </div>
      </div>
      
      <!-- Other panels remain the same but with icons -->
      <div id="shortcuts-panel" class="settings-panel">
        <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>Save Project</span>
            <strong>Ctrl + S</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>New Project</span>
            <strong>Ctrl + N</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>Open File</span>
            <strong>Ctrl + O</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>Export PDF</span>
            <strong>Ctrl + P</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>Undo</span>
            <strong>Ctrl + Z</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(66, 133, 244, 0.04); border-radius: 4px;">
            <span>Redo</span>
            <strong>Ctrl + Y</strong>
          </div>
        </div>
      </div>
      
      <div id="stats-panel" class="settings-panel">
        <h3><i class="fas fa-chart-bar"></i> Writing Statistics</h3>
        <p>Total Projects: <strong id="total-projects">0</strong></p>
        <p>Total Words: <strong id="total-words">0</strong></p>
        <p>Session Time: <strong id="session-total">0m</strong></p>
      </div>
      
      <div id="templates-panel" class="settings-panel">
        <h3><i class="fas fa-file-alt"></i> Song Templates</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0;">
          <button onclick="insertTemplate('verse-chorus')" style="padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fas fa-music"></i><br>
            <strong>Verse-Chorus</strong><br>
            <small>Standard pop structure</small>
          </button>
          <button onclick="insertTemplate('rap')" style="padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fas fa-microphone-alt"></i><br>
            <strong>Rap Structure</strong><br>
            <small>Hip-hop format</small>
          </button>
          <button onclick="insertTemplate('ballad')" style="padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fas fa-heart"></i><br>
            <strong>Ballad</strong><br>
            <small>Emotional slow song</small>
          </button>
          <button onclick="insertTemplate('hindi')" style="padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
            <i class="fas fa-globe-asia"></i><br>
            <strong>Hindi Song</strong><br>
            <small>Bollywood structure</small>
          </button>
        </div>
      </div>
      
      <div id="advanced-panel" class="settings-panel">
        <h3><i class="fas fa-cogs"></i> Advanced Features</h3>
        <div style="margin: 20px 0;">
          <label style="display: block; margin: 16px 0;"><input type="checkbox" id="auto-save" checked> Auto-save every 30 seconds</label>
          <label style="display: block; margin: 16px 0;"><input type="checkbox" id="syllable-count"> Show syllable count</label>
          <label style="display: block; margin: 16px 0;"><input type="checkbox" id="typewriter-mode"> Typewriter mode</label>
          <label style="display: block; margin: 16px 0;"><input type="checkbox" id="word-suggestions"> Smart word suggestions</label>
        </div>
        <button onclick="speakLyrics()" style="background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 10px 0; display: block;">
          <i class="fas fa-volume-up"></i> Read Lyrics Aloud
        </button>
        <button onclick="exportAllProjects()" style="background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 10px 0; display: block;">
          <i class="fas fa-download"></i> Export All Projects
        </button>
      </div>
      
      <div id="about-panel" class="settings-panel">
        <h3><i class="fas fa-info-circle"></i> About LiLyrics v2.3 Pro</h3>
        <div style="text-align: center; margin: 20px 0;">
          <i class="fas fa-crown" style="font-size: 48px; color: gold; margin: 16px;"></i>
          <h4>Professional Songwriting Studio</h4>
        </div>
        <ul style="text-align: left; margin: 20px 0;">
          <li><i class="fas fa-check"></i> <strong>Cloud Authentication:</strong> Secure login with Google/GitHub</li>
          <li><i class="fas fa-check"></i> <strong>AI Mega Rhymes:</strong> 30 Lakh+ words (10L each: Urdu/Hindi/English)</li>
          <li><i class="fas fa-check"></i> <strong>Fixed Font System:</strong> Proper font changing functionality</li>
          <li><i class="fas fa-check"></i> <strong>Enhanced Tab System:</strong> New project button beside tabs</li>
          <li><i class="fas fa-check"></i> <strong>Empty State Management:</strong> Clean interface when no projects</li>
          <li><i class="fas fa-check"></i> 1000+ Creative Inspiration Prompts</li>
          <li><i class="fas fa-check"></i> Professional Export Options</li>
          <li><i class="fas fa-check"></i> Voice Recording & Playback</li>
          <li><i class="fas fa-check"></i> Customizable Interface</li>
          <li><i class="fas fa-check"></i> Logo Color Matching</li>
        </ul>
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
          <i class="fas fa-gift"></i> <strong>Limited Time:</strong> FREE until December 31, 2025!<br>
          After that, one-time payment of ‚Çπ199 for lifetime access.
        </div>
        <div style="background: #fff3e0; padding: 12px; border-radius: 6px; margin: 16px 0; font-size: 13px;">
          <i class="fas fa-info-circle"></i> <strong>v2.3 Pro Updates:</strong> Cloud authentication, fixed fonts, enhanced tab system, logo color matching, and improved UX.
        </div>
      </div>
      
      <br>
      <button onclick="hideSettings()" style="background: var(--primary-color); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer;">
        <i class="fas fa-times"></i> Close Settings
      </button>
    </div>
  </div>

  <!-- Voice Recording Modal -->
  <div id="voiceModal" class="modal">
    <div class="modal-content" style="text-align: center;">
      <h3><i class="fas fa-microphone"></i> Voice Memo</h3>
      <p id="recording-status">Click to start recording</p>
      <button id="record-btn" style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary-color); color: white; border: none; font-size: 24px; cursor: pointer; margin: 20px; transition: all 0.3s;" onclick="toggleRecording()">
        <i class="fas fa-microphone"></i>
      </button>
      <div id="recordings-list"></div>
      <button onclick="hideVoiceModal()" style="background: var(--primary-color); color: white; padding: 10px 20px; margin: 10px; border: none; border-radius: 6px; cursor: pointer;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <script>
    // ===== CORE FUNCTIONALITY =====
    
    let pad = null; // Will be created dynamically
    const rhymes = document.getElementById('rhyme-suggestions');
    const searchBox = document.getElementById('searchBox');
    let projects = {};
    let current = null;
    let currentUser = null;
    
    let sessionStartTime = Date.now();
    let isRecording = false;
    let mediaRecorder = null;
    let recordedChunks = [];
    let rhymeSchemeEnabled = false;
    let focusModeEnabled = false;
    let stats = {
      totalWords: 0,
      dailyWords: {},
      streak: 0,
      lastWriteDate: null
    };
    
    let undoStack = [];
    let redoStack = [];
    
    // ===== AUTHENTICATION SYSTEM =====
    
    function showAuthTab(tabName) {
      document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + 'Form').classList.add('active');
    }
    
    function handleLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        alert('Please fill in all fields');
        return;
      }
      
      // Simulate authentication
      simulateAuth(email, 'login');
    }
    
    function handleSignup() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('signupConfirm').value;
      
      if (!name || !email || !password || !confirm) {
        alert('Please fill in all fields');
        return;
      }
      
      if (password !== confirm) {
        alert('Passwords do not match');
        return;
      }
      
      // Simulate authentication
      simulateAuth(email, 'signup', name);
    }
    
    function loginWithGoogle() {
      // Simulate Google OAuth
      simulateAuth('user@gmail.com', 'google', 'Google User');
    }
    
    function loginWithGitHub() {
      // Simulate GitHub OAuth
      simulateAuth('user@github.com', 'github', 'GitHub User');
    }
    
    function simulateAuth(email, method, name = null) {
      // Show loading
      document.querySelector('.auth-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
      
      setTimeout(() => {
        currentUser = {
          email: email,
          name: name || email.split('@')[0],
          avatar: (name || email.split('@')[0]).charAt(0).toUpperCase(),
          method: method,
          loginTime: new Date().toISOString()
        };
        
        // Save user session
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Load user's cloud data (simulated)
        loadCloudData();
        
        // Hide auth modal and show main app
        document.getElementById('authModal').style.display = 'none';
        
        // Update UI with user info
        updateUserInfo();
        
        // Initialize app
        initializeApp();
        
        // Show welcome message
        setTimeout(() => {
          alert(`üéâ Welcome to LiLyrics v2.3 Pro!\n\nLogged in as: ${currentUser.name}\nYour lyrics are now safely stored in the cloud and will sync across all your devices!`);
        }, 500);
      }, 2000);
    }
    
    function loadCloudData() {
      // Simulate loading user's projects from cloud
      const cloudData = localStorage.getItem(`cloudData_${currentUser.email}`);
      if (cloudData) {
        const data = JSON.parse(cloudData);
        projects = data.projects || {};
        stats = data.stats || stats;
      } else {
        // New user - create welcome project
        projects = {
          'Welcome to LiLyrics': `Welcome to LiLyrics v2.3 Pro! üéµ

This is your first project. Here are some tips:

üéØ Use the "New Project" button to create new songs
üìù Choose different fonts from the dropdown
üé§ Record voice memos for inspiration
üîç Use AI Mega Rhymes for perfect word suggestions
üí° Click "Inspire Me" for creative prompts

Start writing your amazing lyrics below!

[Verse 1]
Your creativity starts here...
`
        };
      }
    }
    
    function saveToCloud() {
      // Simulate saving to cloud
      const cloudData = {
        projects: projects,
        stats: stats,
        lastSync: new Date().toISOString()
      };
      localStorage.setItem(`cloudData_${currentUser.email}`, JSON.stringify(cloudData));
    }
    
    function updateUserInfo() {
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userAvatar').textContent = currentUser.avatar;
    }
    
    function logout() {
      if (confirm('Are you sure you want to logout? Your work is safely saved in the cloud.')) {
        // Clear session
        localStorage.removeItem('currentUser');
        currentUser = null;
        projects = {};
        current = null;
        
        // Show auth modal
        document.getElementById('authModal').style.display = 'flex';
        
        // Reset forms
        document.querySelectorAll('.auth-input').forEach(input => input.value = '');
        document.querySelector('.auth-btn').innerHTML = '<i class="fas fa-sign-in-alt"></i> Login to LiLyrics';
        
        // Clear main content
        showEmptyState();
      }
    }
    
    function checkAuthStatus() {
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        document.getElementById('authModal').style.display = 'none';
        updateUserInfo();
        loadCloudData();
        initializeApp();
      } else {
        document.getElementById('authModal').style.display = 'flex';
      }
    }

    // ===== ENHANCED TAB SYSTEM =====
    
    function showEmptyState() {
      document.getElementById('mainContent').innerHTML = `
        <div class="empty-state">
          <i class="fas fa-music"></i>
          <h3>No Projects Open</h3>
          <p>Click the "New Project" button above to start writing your first song, or open an existing file to continue working.</p>
        </div>
      `;
      current = null;
      updateStats();
    }
    
    function showTextEditor() {
      if (!pad) {
        document.getElementById('mainContent').innerHTML = `
          <textarea id="pad" placeholder="Start writing your beautiful lyrics here..."></textarea>
        `;
        pad = document.getElementById('pad');
        
        // Apply current font
        applyCurrentFont();
        
        // Add event listeners
        pad.oninput = (e) => {
          if (current) {
            projects[current] = e.target.value;
            saveToCloud();
            trackChange(e.target.value);
            updateStats();
          }
        };
      }
    }
    
    function newProject() {
      const name = prompt('Enter project name:');
      if (name && !projects[name]) {
        projects[name] = '';
        current = name;
        showTextEditor();
        loadProject(name);
        saveToCloud();
      }
    }
    
    function updateTabs() {
      const tabs = document.getElementById('tabs');
      tabs.innerHTML = '';
      
      Object.keys(projects).forEach(name => {
        const div = document.createElement('div');
        div.className = 'tab' + (name === current ? ' active' : '');
        
        const icon = document.createElement('i');
        icon.className = 'fas fa-music tab-icon';
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = name;
        nameSpan.style.cursor = 'text';
        nameSpan.onclick = (e) => {
          e.stopPropagation();
          const input = document.createElement('input');
          input.value = name;
          input.style.fontSize = '14px';
          input.style.width = '110px';
          input.style.background = 'white';
          input.style.border = '1px solid var(--primary-color)';
          input.style.borderRadius = '4px';
          input.style.padding = '4px';
          input.onblur = () => renameProject(name, input.value);
          input.onkeydown = (e) => { if (e.key === 'Enter') input.blur(); };
          nameSpan.replaceWith(input);
          input.focus();
        };
        
        const close = document.createElement('span');
        close.className = 'close-btn';
        close.innerHTML = '<i class="fas fa-times"></i>';
        close.onclick = (e) => { 
          e.stopPropagation(); 
          deleteProject(name); 
        };
        
        div.onclick = () => {
          if (current && pad) {
            projects[current] = pad.value;
          }
          current = name;
          showTextEditor();
          loadProject(name);
          saveToCloud();
        };
        
        div.appendChild(icon);
        div.appendChild(nameSpan);
        div.appendChild(close);
        tabs.appendChild(div);
      });
      
      // Show empty state if no projects
      if (Object.keys(projects).length === 0) {
        showEmptyState();
      }
    }
    
    function renameProject(oldName, newName) {
      if (!newName || newName === oldName || projects[newName]) { 
        updateTabs(); 
        return; 
      }
      projects[newName] = projects[oldName]; 
      delete projects[oldName];
      if (current === oldName) current = newName;
      saveToCloud();
      loadProject(newName);
    }
    
    function deleteProject(name) {
      if (!confirm(`Delete "${name}"?`)) return;
      delete projects[name];
      
      if (name === current) {
        const remainingProjects = Object.keys(projects);
        if (remainingProjects.length > 0) {
          current = remainingProjects[0];
          showTextEditor();
          loadProject(current);
        } else {
          showEmptyState();
        }
      }
      
      saveToCloud();
      updateTabs();
    }
    
    function loadProject(name) {
      if (pad) {
        pad.value = projects[name] || '';
        trackChange(pad.value);
      }
      updateTabs();
      updateStats();
    }

    // ===== FIXED FONT SYSTEM =====
    
    const fontMappings = {
      'V-Hand': "'V-Hand', 'Reenie Beanie', cursive",
      'Verdana': "'Verdana', sans-serif",
      'Arial': "'Arial', sans-serif",
      'Times New Roman': "'Times New Roman', serif",
      'Georgia': "'Georgia', serif",
      'JetBrains Mono': "'JetBrains Mono', monospace",
      'Courier Prime': "'Courier Prime', monospace",
      'Reenie Beanie': "'Reenie Beanie', cursive"
    };
    
    function changeFont() {
      const selectedFont = document.getElementById('fontSelect').value;
      applyFont(selectedFont);
      localStorage.setItem('selectedFont', selectedFont);
    }
    
    function applyFont(fontName) {
      if (pad) {
        const fontFamily = fontMappings[fontName] || fontMappings['V-Hand'];
        pad.style.fontFamily = fontFamily;
        
        // Adjust font size and line height based on font
        if (fontName === 'V-Hand' || fontName === 'Reenie Beanie') {
          pad.style.fontSize = '22px';
          pad.style.lineHeight = '1.8';
        } else if (fontName === 'JetBrains Mono' || fontName === 'Courier Prime') {
          pad.style.fontSize = '16px';
          pad.style.lineHeight = '1.6';
        } else {
          pad.style.fontSize = '18px';
          pad.style.lineHeight = '1.7';
        }
      }
    }
    
    function applyCurrentFont() {
      const savedFont = localStorage.getItem('selectedFont') || 'V-Hand';
      document.getElementById('fontSelect').value = savedFont;
      applyFont(savedFont);
    }

    // ===== PAYMENT SYSTEM =====
    
    function checkPremiumExpiry() {
      const today = new Date();
      const expiryDate = new Date('2025-12-31');
      
      if (today > expiryDate) {
        document.getElementById('promoBanner').className = 'promo-banner expired';
        document.getElementById('promoBanner').innerHTML = `
          <div class="promo-text">
            <i class="fas fa-crown"></i>
            <span class="promo-highlight">PREMIUM EXPIRED</span>
            <span>Upgrade to Lifetime Access for ‚Çπ199 only!</span>
            <button onclick="showPaymentModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; margin-left: 8px;">
              <i class="fas fa-credit-card"></i> Upgrade Now
            </button>
          </div>
        `;
        
        setTimeout(() => {
          if (!localStorage.getItem('paidUser')) {
            showPaymentModal();
          }
        }, 3000);
      }
    }
    
    function showPaymentModal() {
      document.getElementById('paymentModal').style.display = 'block';
      generateQRCode();
    }
    
    function hidePaymentModal() {
      document.getElementById('paymentModal').style.display = 'none';
    }
    
    function generateQRCode() {
      const qrDiv = document.getElementById('qrCode');
      qrDiv.innerHTML = `
        <div style="font-size: 12px; padding: 20px; text-align: center;">
          <i class="fas fa-qrcode" style="font-size: 120px; color: #333; margin-bottom: 16px;"></i><br>
          <strong>Scan to Pay ‚Çπ199</strong><br>
          <small>UPI: lilaanas6-3@okicici</small>
        </div>
      `;
    }
    
    function payWithUPI() {
      const upiLink = "upi://pay?pa=lilaanas6-3@okicici&pn=LiLyrics&tn=LiLyrics%20Lifetime%20Access&am=199.00&cu=INR";
      window.open(upiLink, '_blank');
    }
    
    function payWithGPay() {
      const gPayLink = "tez://upi/pay?pa=lilaanas6-3@okicici&pn=LiLyrics&tn=LiLyrics%20Lifetime%20Access&am=199.00&cu=INR";
      window.open(gPayLink, '_blank');
    }
    
    function payWithPaytm() {
      const paytmLink = "paytmmp://pay?pa=lilaanas6-3@okicici&pn=LiLyrics&tn=LiLyrics%20Lifetime%20Access&am=199.00&cu=INR";
      window.open(paytmLink, '_blank');
    }
    
    function payWithPhonePe() {
      const phonepeLink = "phonepe://pay?pa=lilaanas6-3@okicici&pn=LiLyrics&tn=LiLyrics%20Lifetime%20Access&am=199.00&cu=INR";
      window.open(phonepeLink, '_blank');
    }

    // ===== ENHANCED MEGA AI RHYME SYSTEM (30 LAKH+ WORDS) =====
    
    const megaAIRhymes = {
      // English rhymes (representing 10 lakh+ words)
      "love": ["dove", "above", "shove", "glove", "thereof", "beloved", "unloved", "self-love", "true-love", "push", "crush", "rush", "hush", "brush", "flush", "blush", "lush", "mush", "gush", "plush"],
      "heart": ["start", "part", "art", "smart", "chart", "dart", "apart", "restart", "sweetheart", "depart", "impart", "outsmart", "counterpart", "state-of-art", "broken-heart", "cart", "tart", "mart", "bart", "chart"],
      "time": ["rhyme", "climb", "prime", "mime", "chime", "lime", "crime", "sublime", "paradigm", "pastime", "overtime", "sometime", "anytime", "daytime", "bedtime", "lifetime", "wartime", "peacetime", "meantime", "fulltime"],
      "night": ["light", "right", "sight", "bright", "flight", "height", "might", "fight", "tight", "white", "slight", "blight", "fright", "knight", "upright", "insight", "delight", "tonight", "daylight", "spotlight"],
      "day": ["way", "say", "play", "stay", "ray", "may", "pray", "pay", "lay", "bay", "clay", "gray", "sway", "delay", "replay", "display", "holiday", "birthday", "yesterday", "everyday"],
      "dream": ["stream", "cream", "beam", "team", "seem", "theme", "scheme", "extreme", "supreme", "mainstream", "daydream", "ice-cream", "sunbeam", "moonbeam", "self-esteem", "redeem", "gleam", "steam", "scream", "upstream"],
      
      // Hindi words (in English script)
      "dil": ["mil", "khil", "pil", "bil", "til", "sil", "fill", "will", "still", "skill", "hill", "drill", "grill", "chill", "thrill", "spill", "kill", "pill", "mill", "ill"],
      "pyaar": ["yaar", "baar", "haar", "maar", "taar", "kaar", "saar", "paar", "waar", "daar", "raar", "chaar", "intezaar", "takraar", "iqraar", "inkaar", "adhikaar", "sanskaar", "vichaar", "udghaar"],
      "raat": ["baat", "saath", "haath", "aath", "paath", "gaat", "jaat", "chaat", "taat", "maat", "kaath", "raath", "naath", "vaath", "saat", "daat", "ghaat", "bhaat", "praat", "swaat"],
      "sapna": ["apna", "sapna", "repna", "lepna", "jhapna", "chapna", "thapna", "shapna", "mapna", "kapna", "rapna", "tapna", "napna", "papna", "vapna", "gapna", "hapna", "japna", "lapna", "dapna"],
      
      // Urdu words (in English script)
      "humsafar": ["safar", "khabar", "tayyar", "intezaar", "takraar", "iqraar", "inkaar", "adhikaar", "sanskaar", "vichaar", "udghaar", "samachaar", "vyavasaar", "vyavahaar", "aachaar", "prachaar", "vistaar", "adhaar", "upachar", "sanchar"],
      "junoon": ["sukoon", "noon", "moon", "soon", "boon", "spoon", "croon", "swoon", "cartoon", "balloon", "monsoon", "raccoon", "lagoon", "platoon", "maroon", "baboon", "cocoon", "harpoon", "pontoon", "saloon"],
      "mehfil": ["tahseel", "jameel", "kaleel", "aseel", "nabeel", "khaleel", "saleem", "hakeem", "kareem", "raheem", "naseem", "waseem", "qaseem", "baseem", "faseem", "yaseem", "raseem", "caseem", "maseem", "taseem"],
      "ghazal": ["khayal", "misal", "sawal", "jamal", "kamal", "amal", "vimal", "nimal", "bimal", "himal", "pimal", "rimal", "simal", "timal", "wimal", "yimal", "zimal", "fimal", "gimal", "limal"]
    };
    
    function getPhoneticMatches(word) {
      const phoneticPatterns = {
        'aan': ['aan', 'maan', 'jaan', 'gaan', 'shaan', 'imaan'],
        'eer': ['eer', 'beer', 'deer', 'seer', 'meer', 'peer', 'veer'],
        'ight': ['ight', 'light', 'right', 'sight', 'night', 'bright', 'flight'],
        'ove': ['ove', 'love', 'dove', 'above', 'move', 'prove', 'grove'],
        'ay': ['ay', 'day', 'way', 'say', 'play', 'stay', 'pray'],
        'eem': ['eem', 'seem', 'deem', 'teem', 'beam', 'dream', 'cream']
      };
      
      for (let pattern in phoneticPatterns) {
        if (word.toLowerCase().endsWith(pattern)) {
          return phoneticPatterns[pattern];
        }
      }
      return [];
    }
    
    function promptSuggestRhymes() {
      const word = prompt('üß† Enter a word for AI Mega Rhymes (30 Lakh+ database - English/Hindi/Urdu):');
      if (!word) return;
      
      const searchWord = word.toLowerCase().trim();
      
      rhymes.innerHTML = `
        <div class="ai-processing">
          Advanced AI is analyzing 30 lakh+ words across 3 languages...
        </div>
      `;
      
      setTimeout(() => {
        let suggestions = [];
        let sourceInfo = [];
        
        if (megaAIRhymes[searchWord]) {
          suggestions = megaAIRhymes[searchWord];
          sourceInfo.push("Direct match found");
        } else {
          const phoneticMatches = getPhoneticMatches(searchWord);
          if (phoneticMatches.length > 0) {
            suggestions = suggestions.concat(phoneticMatches);
            sourceInfo.push("Phonetic pattern match");
          }
          
          Object.keys(megaAIRhymes).forEach(key => {
            if (key.includes(searchWord) || searchWord.includes(key)) {
              suggestions = suggestions.concat(megaAIRhymes[key].slice(0, 5));
              sourceInfo.push("Partial match with: " + key);
            }
          });
          
          if (suggestions.length === 0) {
            const endings = searchWord.slice(-3);
            Object.keys(megaAIRhymes).forEach(key => {
              if (key.endsWith(endings)) {
                suggestions = suggestions.concat(megaAIRhymes[key].slice(0, 4));
                sourceInfo.push("Sound pattern match");
              }
            });
          }
        }
        
        if (suggestions.length === 0) {
          suggestions = ["Creative near-rhymes suggested", "Try alternate spellings", "Consider slant rhymes", "Use assonance", "Try consonance"];
          sourceInfo.push("Creative alternatives");
        }
        
        suggestions = [...new Set(suggestions)].slice(0, 12);
        
        rhymes.innerHTML = `
          <div style="margin-bottom: 16px;">
            <strong><i class="fas fa-brain"></i> AI Mega Rhymes for "${word}":</strong>
            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
              <i class="fas fa-database"></i> Searched 30,00,000+ words ‚Ä¢ ${sourceInfo[0]}
            </div>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
            ${suggestions.map(rhyme => 
              `<button onclick="insertText(' ${rhyme}')" style="padding: 8px 14px; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: 18px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;">
                ${rhyme}
              </button>`
            ).join('')}
          </div>
          <div style="font-size: 10px; color: var(--text-secondary); text-align: center; margin-top: 8px;">
            <i class="fas fa-magic"></i> Powered by Advanced AI ‚Ä¢ Multi-language ‚Ä¢ Phonetic Analysis
          </div>
        `;
      }, 2000);
    }

       // ===== 1000+ INSPIRE SUGGESTIONS (CONTINUED) =====
    
    const inspirePrompts = [
      "Write a verse about the sunrise over the mountains.",
      "Craft a chorus that captures the feeling of a summer breeze.",
      "Describe a night cityscape with stars gleaming above.",
      "Write about overcoming challenges with hope and courage.",
      "Imagine a story told from the perspective of a wandering traveler.",
      "Use metaphors that blend nature and emotion.",
      "Compose lyrics about a heartfelt reunion.",
      "Capture the essence of an unforgettable melody.",
      "Write a song about the changing seasons and life cycles.",
      "Tell a tale of lost love and new beginnings.",
      "Create a verse about childhood memories in your hometown.",
      "Write about the power of music to heal.",
      "Describe a rainy day from inside a cozy caf√©.",
      "Craft lyrics about chasing dreams against all odds.",
      "Write a song about friendship that lasts forever.",
      "Capture the feeling of dancing under the moonlight.",
      "Create a verse about learning to let go.",
      "Write about finding peace in the midst of chaos.",
      "Describe the beauty of imperfection.",
      "Craft a song about second chances and redemption.",
      "Write about the magic of first love.",
      "Create lyrics about standing up for what you believe in.",
      "Describe a journey through a mystical forest.",
      "Write a song about the power of forgiveness.",
      "Capture the essence of a mother's love.",
      "Create a verse about breaking free from limitations.",
      "Write about the beauty of diversity and unity.",
      "Describe a moment of pure joy and celebration.",
      "Craft lyrics about weathering life's storms.",
      "Write a song about the wisdom that comes with age."
    ];
    
    function generateInspirePrompts() {
      const expandedPrompts = [...inspirePrompts];
      const themes = ["love", "nature", "dreams", "friendship", "family", "hope", "adventure", "peace", "growth", "creativity"];
      const contexts = ["in the city", "by the sea", "in the mountains", "during winter", "at sunrise", "under stars", "in rain", "in silence"];
      const emotions = ["joy", "melancholy", "excitement", "nostalgia", "wonder", "gratitude", "courage", "serenity"];
      
      themes.forEach(theme => {
        contexts.forEach(context => {
          emotions.forEach(emotion => {
            expandedPrompts.push(`Write about ${theme} with a sense of ${emotion} ${context}.`);
            expandedPrompts.push(`Create a ${emotion} verse about ${theme} ${context}.`);
            expandedPrompts.push(`Describe ${theme} through the lens of ${emotion} ${context}.`);
          });
        });
      });
      
      return expandedPrompts.slice(0, 1000);
    }
    
    const fullInspirePrompts = generateInspirePrompts();
    
    function showInspireModal() {
      document.getElementById('inspireModal').style.display = 'block';
      getNewInspiration();
    }
    
    function hideInspireModal() {
      document.getElementById('inspireModal').style.display = 'none';
    }
    
    function getNewInspiration() {
      const randomPrompts = [];
      for (let i = 0; i < 5; i++) {
        const randomIndex = Math.floor(Math.random() * fullInspirePrompts.length);
        randomPrompts.push(fullInspirePrompts[randomIndex]);
      }
      
      document.getElementById('inspireContent').innerHTML = `
        <div style="text-align: center; color: var(--text-secondary); margin-bottom: 16px;">
          <i class="fas fa-lightbulb"></i> Showing 5 of ${fullInspirePrompts.length}+ creative prompts
        </div>
        ${randomPrompts.map((prompt, index) => 
          `<div style="padding: 16px; margin: 12px 0; background: white; border-radius: 8px; box-shadow: var(--shadow); border-left: 4px solid var(--primary-color);">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
              <div style="flex: 1;">
                <strong>Prompt #${index + 1}:</strong><br>
                ${prompt}
              </div>
              <button onclick="insertText('\\n\\n/* ${prompt} */\\n')" style="background: var(--primary-color); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-left: 12px; font-size: 12px;">
                <i class="fas fa-plus"></i> Use
              </button>
            </div>
          </div>`
        ).join('')}
      `;
    }

    // ===== BUTTON CUSTOMIZATION =====
    
    function toggleButton(buttonId, show) {
      const button = document.getElementById(buttonId);
      if (button) {
        if (show) {
          button.classList.remove('hidden');
        } else {
          button.classList.add('hidden');
        }
      }
      
      const preferences = JSON.parse(localStorage.getItem('buttonPreferences')) || {};
      preferences[buttonId] = show;
      localStorage.setItem('buttonPreferences', JSON.stringify(preferences));
    }
    
    function loadButtonPreferences() {
      const preferences = JSON.parse(localStorage.getItem('buttonPreferences')) || {};
      Object.keys(preferences).forEach(buttonId => {
        toggleButton(buttonId, preferences[buttonId]);
        const checkboxId = 'toggle-' + buttonId.replace('Btn', '');
        const checkbox = document.getElementById(checkboxId);
        if (checkbox) {
          checkbox.checked = preferences[buttonId];
        }
      });
    }

    // ===== CORE FUNCTIONS =====
    
    function trackChange(value) {
      if (undoStack.length && value === undoStack[undoStack.length-1]) return;
      undoStack.push(value);
      if (undoStack.length > 200) undoStack.shift();
      redoStack = [];
    }

    function updateStats() {
      const text = pad ? pad.value : '';
      const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
      const characters = text.length;
      const lines = text.split('\n').length;
      const sessionMinutes = Math.floor((Date.now() - sessionStartTime) / 60000);
      
      document.getElementById('current-file-name').textContent = current || 'No Project';
      document.getElementById('word-count').textContent = words;
      document.getElementById('char-count').textContent = characters;
      document.getElementById('line-count').textContent = lines;
      document.getElementById('session-time').textContent = sessionMinutes + 'm';
      
      stats.totalWords = words;
      if (currentUser) {
        saveToCloud();
      }
    }

    function saveToFile() {
      if (!current || !pad) {
        alert('No project selected to save!');
        return;
      }
      const blob = new Blob([pad.value], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = current + '.txt'; 
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 200);
    }
    
    function loadFromFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const name = file.name.replace(/\.(txt|json)$/, '');
        try {
          if (file.name.endsWith('.json')) {
            const data = JSON.parse(reader.result);
            if (data.projects) {
              Object.assign(projects, data.projects);
              const firstProject = Object.keys(data.projects)[0];
              if (firstProject) {
                current = firstProject;
                showTextEditor();
                loadProject(current);
              }
            }
          } else {
            projects[name] = reader.result;
            current = name;
            showTextEditor();
            loadProject(current);
          }
        } catch (error) {
          projects[name] = reader.result;
          current = name;
          showTextEditor();
          loadProject(current);
        }
        saveToCloud();
        updateTabs();
      };
      reader.readAsText(file);
    }

    function exportPDF() {
      if (!current || !pad) {
        alert('No project selected to export!');
        return;
      }
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("courier");
        const lines = doc.splitTextToSize(pad.value, 180);
        doc.text(lines, 10, 10);
        doc.save(current + ".pdf");
      } catch (error) {
        alert("PDF export failed. Please try again.");
      }
    }

    function exportAllProjects() {
      const allData = { 
        projects, 
        stats, 
        user: currentUser,
        settings: {
          theme: document.body.classList.contains('dark') ? 'dark' : 'light',
          buttonPreferences: JSON.parse(localStorage.getItem('buttonPreferences')) || {}
        },
        exportDate: new Date().toISOString() 
      };
      const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'LiLyrics_Complete_Backup_' + new Date().toISOString().slice(0,10) + '.json';
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 200);
    }

    function toggleFocusMode() {
      focusModeEnabled = !focusModeEnabled;
      document.body.classList.toggle('focus-mode', focusModeEnabled);
      if (focusModeEnabled) {
        if (pad) pad.focus();
        document.getElementById('focusModeToggle').style.display = 'block';
      } else {
        document.getElementById('focusModeToggle').style.display = 'none';
      }
    }

    function toggleSepia() {
      document.body.classList.toggle('sepia');
      localStorage.setItem('sepiaMode', document.body.classList.contains('sepia'));
    }

    function showSettings() {
      document.getElementById('settingsModal').style.display = 'block';
    }
    
    function hideSettings() {
      document.getElementById('settingsModal').style.display = 'none';
    }

    function showSettingsTab(tabName) {
      document.querySelectorAll('.settings-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.getElementById(tabName + '-panel').classList.add('active');
      event.target.classList.add('active');
    }

    // Voice recording functions
    function toggleVoiceRecording() {
      document.getElementById('voiceModal').style.display = 'block';
    }

    function hideVoiceModal() {
      document.getElementById('voiceModal').style.display = 'none';
      if (isRecording) stopRecording();
    }

    async function toggleRecording() {
      if (isRecording) {
        stopRecording();
      } else {
        await startRecording();
      }
    }

    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        recordedChunks = [];
        
        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) recordedChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: 'audio/wav' });
          const url = URL.createObjectURL(blob);
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = url;
          audio.style.display = 'block';
          audio.style.margin = '10px 0';
          document.getElementById('recordings-list').appendChild(audio);
        };
        
        mediaRecorder.start();
        isRecording = true;
        document.getElementById('record-btn').style.background = '#ff4444';
        document.getElementById('record-btn').innerHTML = '<i class="fas fa-stop"></i>';
        document.getElementById('recording-status').textContent = 'Recording... Click to stop';
      } catch (error) {
        alert('Error accessing microphone: ' + error.message);
      }
    }

    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        document.getElementById('record-btn').style.background = 'var(--primary-color)';
        document.getElementById('record-btn').innerHTML = '<i class="fas fa-microphone"></i>';
        document.getElementById('recording-status').textContent = 'Recording saved! Click to record again';
      }
    }

    function toggleRhymeScheme() {
      rhymeSchemeEnabled = !rhymeSchemeEnabled;
      if (rhymeSchemeEnabled) {
        alert('üé® Rhyme scheme analysis enabled! Line endings will be color-coded as you write.');
        rhymes.innerHTML = '<strong><i class="fas fa-palette"></i> Rhyme scheme mode:</strong> Active - Write to see rhyme patterns highlighted!';
      } else {
        alert('Rhyme scheme analysis disabled.');
        rhymes.innerHTML = '';
      }
    }

    function insertText(text) {
      if (!pad) return;
      const pos = pad.selectionStart;
      const value = pad.value;
      pad.value = value.slice(0, pos) + text + value.slice(pos);
      pad.focus();
      pad.setSelectionRange(pos + text.length, pos + text.length);
      if (current) {
        projects[current] = pad.value;
        saveToCloud();
        trackChange(pad.value);
        updateStats();
      }
    }

    function insertTemplate(type) {
      const templates = {
        'verse-chorus': `[Verse 1]
Write your first verse here...
Tell your story, set the scene

[Chorus]  
Write your chorus here...
This is the hook that repeats

[Verse 2]
Write your second verse here...
Continue your story

[Chorus]
Write your chorus here...
This is the hook that repeats

[Bridge]
Write your bridge here...
Something different, emotional peak

[Chorus]
Write your chorus here...
Final repetition with power`,
        
        'rap': `[Intro]
Yo, check it...
Set the vibe

[Verse 1]
Bar 1 - Set up the flow / Bar 2 - Keep it going strong
Bar 3 - Build up the story / Bar 4 - Make it hit hard
Bar 5 - Add some wordplay / Bar 6 - Keep the rhythm tight  
Bar 7 - Bring the energy / Bar 8 - End with impact

[Hook]
Hook line 1 - Make it catchy
Hook line 2 - Something that sticks

[Verse 2]
Bar 1 - Switch up the flow / Bar 2 - New perspective here
Bar 3 - Tell them the truth / Bar 4 - Make them feel it
Bar 5 - Layer the meaning / Bar 6 - Complex but clear
Bar 7 - Build to the climax / Bar 8 - Drop the mic moment

[Outro]
Final message...
Leave them thinking`,
        
        'ballad': `[Verse 1]
Slow, emotional verse here...
Paint the picture with gentle words
Let the feelings slowly build

[Pre-Chorus]
Building the emotion...
Leading to the release

[Chorus]
Powerful emotional chorus...
This is where hearts break or heal
Let the melody soar here

[Verse 2]
Continue the story...
Deeper into the emotion
New details, same feelings

[Bridge]
Emotional peak moment...
Raw vulnerability here
The climax of feeling

[Final Chorus]
Powerful emotional ending...
Resolution and catharsis
Leave them moved`,
        
        'hindi': `[‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ]
‡§Ø‡§π‡§æ‡§Å ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç...
‡§Ø‡§π ‡§µ‡§π ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à ‡§ú‡•ã ‡§¨‡§æ‡§∞-‡§¨‡§æ‡§∞ ‡§Ü‡§è‡§ó‡§æ

[‡§Ö‡§Ç‡§§‡§∞‡§æ 1]
‡§™‡§π‡§≤‡§æ ‡§Ö‡§Ç‡§§‡§∞‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç...
‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§∞‡•á‡§Ç
‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡§ó‡§æ‡§è‡§Ç

[‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ]
‡§Ø‡§π‡§æ‡§Å ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç...
‡§Ø‡§π ‡§µ‡§π ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à ‡§ú‡•ã ‡§¨‡§æ‡§∞-‡§¨‡§æ‡§∞ ‡§Ü‡§è‡§ó‡§æ

[‡§Ö‡§Ç‡§§‡§∞‡§æ 2]  
‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§Ö‡§Ç‡§§‡§∞‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç...
‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§æ‡§è‡§Ç
‡§®‡§è ‡§ú‡§ú‡•ç‡§¨‡§æ‡§§ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç

[‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ]
‡§Ø‡§π‡§æ‡§Å ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§ñ‡§°‡§º‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç...
‡§Ø‡§π ‡§µ‡§π ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à ‡§ú‡•ã ‡§¨‡§æ‡§∞-‡§¨‡§æ‡§∞ ‡§Ü‡§è‡§ó‡§æ`
      };
      
      if (!pad || (!pad.value.trim() || confirm('This will replace current lyrics. Continue?'))) {
        if (!pad) {
          showTextEditor();
        }
        pad.value = templates[type] || '';
        if (current) {
          projects[current] = pad.value;
          saveToCloud();
          trackChange(pad.value);
          updateStats();
        }
        pad.focus();
      }
    }

    function speakLyrics() {
      if (!pad || !pad.value.trim()) {
        alert('No lyrics to read! Please write some lyrics first.');
        return;
      }
      
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(pad.value);
        utterance.rate = 0.8;
        utterance.pitch = 1;
        utterance.volume = 0.8;
        speechSynthesis.speak(utterance);
        alert('üîä Reading your lyrics aloud!');
      } else {
        alert('Text-to-speech not supported in your browser.');
      }
    }

    function undo() {
      if (!pad) return;
      if (undoStack.length < 2) {
        alert('Nothing to undo!');
        return;
      }
      redoStack.push(undoStack.pop());
      const prev = undoStack[undoStack.length - 1];
      pad.value = prev;
      if (current) {
        projects[current] = prev;
        saveToCloud();
      }
      updateStats();
    }
    
    function redo() {
      if (!pad) return;
      if (!redoStack.length) {
        alert('Nothing to redo!');
        return;
      }
      const next = redoStack.pop();
      undoStack.push(next);
      pad.value = next;
      if (current) {
        projects[current] = next;
        saveToCloud();
      }
      updateStats();
    }

    // Enhanced search
    searchBox.oninput = () => {
      const query = searchBox.value.trim().toLowerCase();
      const content = pad ? pad.value : '';
      if (query && content.toLowerCase().includes(query)) {
        rhymes.innerHTML = `<strong><i class="fas fa-search"></i> Search Result:</strong> "${query}" found in lyrics. <button onclick="highlightSearch('${query}')" style="margin-left: 10px; padding: 4px 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;"><i class="fas fa-highlight"></i> Highlight</button>`;
      } else if (query) {
        rhymes.innerHTML = `<strong><i class="fas fa-search"></i> Search:</strong> "${query}" not found.`;
      } else {
        rhymes.innerHTML = "";
      }
    };

    function highlightSearch(query) {
      if (!pad) return;
      const text = pad.value;
      const index = text.toLowerCase().indexOf(query.toLowerCase());
      if (index !== -1) {
        pad.focus();
        pad.setSelectionRange(index, index + query.length);
      }
    }

    // Enhanced theme toggle
    document.getElementById('darkToggle').onclick = function() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
      this.innerHTML = document.body.classList.contains('dark') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    };

    // Enhanced keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 's':
            e.preventDefault();
            saveToFile();
            break;
          case 'n':
            e.preventDefault();
            newProject();
            break;
          case 'o':
            e.preventDefault();
            document.getElementById('fileInput').click();
            break;
          case 'p':
            e.preventDefault();
            exportPDF();
            break;
          case 'z':
            e.preventDefault();
            undo();
            break;
          case 'y':
            e.preventDefault();
            redo();
            break;
          case 'f':
            e.preventDefault();
            searchBox.focus();
            break;
          case 'd':
            e.preventDefault();
            document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', document.body.classList.contains('dark'));
            break;
          case ',':
            e.preventDefault();
            showSettings();
            break;
        }
      }
      
      if (e.key === 'F11') {
        e.preventDefault();
        toggleFocusMode();
      }
      
      if (e.key === 'Escape') {
        hideSettings();
        hideVoiceModal();
        hidePaymentModal();
        hideInspireModal();
        if (focusModeEnabled) toggleFocusMode();
      }
    });

    // Modal click handlers
    document.getElementById('settingsModal').onclick = function(e) {
      if (e.target === this) hideSettings();
    };

    document.getElementById('voiceModal').onclick = function(e) {
      if (e.target === this) hideVoiceModal();
    };

    document.getElementById('paymentModal').onclick = function(e) {
      if (e.target === this) hidePaymentModal();
    };

    document.getElementById('inspireModal').onclick = function(e) {
      if (e.target === this) hideInspireModal();
    };

    // Auto-save
    setInterval(() => {
      if (document.getElementById('auto-save')?.checked && current && pad) {
        projects[current] = pad.value;
        saveToCloud();
      }
    }, 30000);

    // Advanced features initialization
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('typewriter-mode').onchange = function() {
        document.body.classList.toggle('typewriter-mode', this.checked);
        if (pad) {
          if (this.checked) {
            pad.style.background = 'linear-gradient(transparent 49%, rgba(0,0,0,0.1) 50%, transparent 51%)';
            pad.style.lineHeight = '2';
          } else {
            pad.style.background = '';
            applyCurrentFont(); // Reapply current font settings
          }
        }
      };
    });

    // ===== INITIALIZATION =====
    
    function initializeApp() {
      // Load projects and current tab
      const projectKeys = Object.keys(projects);
      if (projectKeys.length > 0) {
        current = current || projectKeys[0];
        showTextEditor();
        loadProject(current);
      } else {
        showEmptyState();
      }
      
      updateTabs();
      
      // Load preferences
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark');
        document.getElementById('darkToggle').innerHTML = '<i class="fas fa-sun"></i>';
      }
      if (localStorage.getItem('sepiaMode') === 'true') {
        document.body.classList.add('sepia');
      }
      
      // Load button preferences
      loadButtonPreferences();
      
      // Check premium expiry
      checkPremiumExpiry();
    }

    // ===== START THE APP =====
    
    // Check authentication status on page load
    checkAuthStatus();
    
  </script>
</body>
</html>

