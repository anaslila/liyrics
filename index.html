<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/14384/14384748.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <title>LiLyrics v2.5 Premiere - Ultimate Songwriting Studio</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Product+Sans:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary-color: #4285f4;
      --secondary-color: #34a853;
      --error-color: #ea4335;
      --warning-color: #fbbc04;
      --surface-color: #ffffff;
      --background-color: #fafafa;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --border-color: #dadce0;
      --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-elevated: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
      --logo-color: #ff6b35;
      --premiere: linear-gradient(45deg, #8B5CF6, #EC4899);
    }
    
    .fas, .far, .fab, .fal, .fad {
      font-family: "Font Awesome 6 Free", "Font Awesome 5 Free", "Font Awesome 5 Pro", FontAwesome !important;
      font-weight: 900 !important;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-style: normal !important;
      font-variant: normal !important;
      text-rendering: auto !important;
      line-height: 1 !important;
      display: inline-block !important;
    }
    
    .far { font-weight: 400 !important; }
    .fab { font-family: "Font Awesome 6 Brands", "Font Awesome 5 Brands" !important; font-weight: 400 !important; }
    
    body, input, textarea, button:not(.fas):not(.far):not(.fab), select {
      font-family: 'Product Sans', 'Montserrat', sans-serif !important;
    }
    
    body {
      margin: 0;
      background: var(--background-color);
      color: var(--text-primary);
      transition: all 0.3s ease;
      line-height: 1.5;
      font-weight: 400;
    }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    @keyframes glow { from { box-shadow: 0 0 20px rgba(66, 133, 244, 0.3); } to { box-shadow: 0 0 30px rgba(66, 133, 244, 0.6); } }
    @keyframes shine { 0% { left: -100%; } 100% { left: 100%; } }
    @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes premiereGlow { 0% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.4); } 50% { box-shadow: 0 0 25px rgba(236, 72, 153, 0.6); } 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.4); } }
    
    /* Enhanced Premiere Banner */
    .lifetime-banner {
      background: linear-gradient(135deg, #8B5CF6, #EC4899, #F59E0B);
      color: white;
      text-align: center;
      padding: 18px;
      padding-right: 60px;
      font-weight: 600;
      animation: premiereGlow 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }
    
    .lifetime-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shine 2s infinite;
    }
    
    .lifetime-text {
      position: relative;
      z-index: 1;
      font-size: 17px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .lifetime-highlight {
      background: rgba(255,255,255,0.25);
      padding: 6px 16px;
      border-radius: 25px;
      font-weight: 700;
      animation: pulse 2s infinite;
      font-size: 18px;
      border: 2px solid rgba(255,255,255,0.3);
    }
    
    .lifetime-banner .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: background 0.3s ease;
      z-index: 10;
      font-family: Arial, sans-serif !important;
    }
    
    .lifetime-banner .close-btn:hover {
      background: rgba(0,0,0,0.5);
    }
    
    .donate-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      backdrop-filter: blur(8px);
    }
    
    .donate-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface-color);
      padding: 40px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }
    
    header {
      text-align: center;
      padding: 28px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      position: relative;
      box-shadow: var(--shadow);
    }
    
    .logo-line {
      font-family: 'Product Sans', 'Montserrat', sans-serif !important;
      font-size: 40px;
      font-weight: 700;
      background: var(--premiere);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      animation: fadeIn 0.6s ease;
      position: relative;
    }
    
    .logo-line img {
      width: 36px;
      height: 36px;
      animation: pulse 2s infinite;
      filter: hue-rotate(240deg) brightness(1.2);
    }
    
    .version-pro {
      position: absolute;
      right: -90px;
      top: -10px;
      background: var(--premiere);
      color: white;
      padding: 6px 14px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 700;
      font-family: 'Product Sans', 'Montserrat', sans-serif;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      animation: premiereGlow 2s ease-in-out infinite;
    }
    
    .tagline {
      font-size: 16px;
      color: var(--text-secondary);
      margin-top: 10px;
      font-weight: 500;
    }
    
    .donate-btn {
      position: absolute;
      top: 18px;
      left: 18px;
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(255, 107, 53, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .donate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.4);
    }
    
    #darkToggle {
      position: absolute;
      top: 18px;
      right: 18px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 12px;
      border-radius: 50%;
      transition: all 0.2s ease;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #darkToggle:hover {
      background: rgba(0,0,0,0.1);
      transform: scale(1.1);
    }
    
    #tabs-container {
      display: flex;
      align-items: stretch;
      background: var(--surface-color);
      border-bottom: 3px solid var(--primary-color);
      padding: 0;
      box-shadow: var(--shadow);
      margin: 10px 0;
      border-radius: 10px 10px 0 0;
      overflow-x: auto;
      overflow-y: hidden;
    }
    
    #tabs {
      display: flex;
      align-items: stretch;
      min-height: 48px;
      flex: 1;
      overflow-x: auto;
      overflow-y: hidden;
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) transparent;
    }
    
    #tabs::-webkit-scrollbar { height: 6px; }
    #tabs::-webkit-scrollbar-track { background: transparent; }
    #tabs::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    
    .tab {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      cursor: pointer;
      flex-shrink: 0;
      min-width: 110px;
      max-width: 160px;
      transition: all 0.3s ease;
      position: relative;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      border-radius: 15px 15px 0 0;
      margin-right: 4px;
      font-size: 13px;
      box-shadow: 0 4px 10px rgba(66, 133, 244, 0.25);
      gap: 8px;
    }
    
    .tab:hover {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: #ffffff;
      box-shadow: 0 6px 15px rgba(66, 133, 244, 0.4);
      transform: translateY(-2px);
    }
    
    .tab.active {
      background: var(--premiere);
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.4);
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.5);
    }
    
    .tab .tab-icon {
      flex-shrink: 0;
      color: #ffffff;
      opacity: 1;
      font-size: 13px;
      width: 13px;
      height: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tab.active .tab-icon { color: #ffffff; opacity: 1; }
    
    .tab-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-size: 13px;
      line-height: 1;
    }
    
    .tab .close-btn {
      color: rgba(255,255,255,0.9);
      background: rgba(0,0,0,0.2);
      cursor: pointer;
      flex-shrink: 0;
      padding: 3px;
      border-radius: 50%;
      transition: all 0.2s ease;
      font-size: 14px;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: Arial, sans-serif !important;
    }
    
    .tab.active .close-btn { color: rgba(255,255,255,0.9); background: rgba(0,0,0,0.3); }
    .tab:hover .close-btn { background: rgba(0,0,0,0.4); }
    .tab .close-btn:hover { background: rgba(0,0,0,0.5); transform: scale(1.1); }
    
    #addNewTab {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 45px;
      height: 38px;
      cursor: pointer;
      background: var(--premiere);
      color: white;
      border: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      flex-shrink: 0;
      font-size: 22px;
      margin-left: 8px;
      box-shadow: 0 4px 10px rgba(139, 92, 246, 0.4);
    }
    
    #addNewTab:hover {
      box-shadow: 0 8px 18px rgba(236, 72, 153, 0.6);
      transform: translateY(-2px);
    }
    
    #dashboardNewTab {
      display: flex !important;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 35px auto;
      padding: 15px 30px;
      font-size: 18px;
      background: var(--premiere);
      color: white;
      border: none;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(139, 92, 246, 0.4);
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Product Sans', 'Montserrat', sans-serif !important;
      font-weight: 600;
    }
    
    #dashboardNewTab:hover {
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.6);
      transform: translateY(-3px);
    }
    
    /* NEW: Syllable Counter & Line Numbers */
    #editor-container {
      display: flex;
      position: relative;
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
    }
    
    #line-numbers {
      width: 60px;
      background: #f8f9fa;
      border-right: 2px solid var(--border-color);
      padding: 24px 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.7;
      text-align: right;
      user-select: none;
      overflow: hidden;
    }
    
    #syllable-counter {
      width: 80px;
      background: #e8f5e8;
      border-right: 2px solid var(--secondary-color);
      padding: 24px 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--secondary-color);
      line-height: 1.7;
      text-align: center;
      user-select: none;
      font-weight: 600;
      overflow: hidden;
    }
    
    #controls {
      display: flex;
      gap: 12px;
      padding: 18px;
      background: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      flex-wrap: wrap;
      align-items: center;
      box-shadow: var(--shadow);
    }
    
    button, select, input[type="search"] {
      padding: 10px 18px;
      font-size: 14px;
      font-family: 'Product Sans', 'Montserrat', sans-serif !important;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--surface-color);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      outline: none;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    
    button:hover {
      background: rgba(66, 133, 244, 0.06);
      border-color: var(--primary-color);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    
    button.hidden { display: none; }
    
    /* NEW: Enhanced AI Features */
    .ai-button {
      background: var(--premiere) !important;
      color: white !important;
      border: none !important;
      animation: premiereGlow 3s ease-in-out infinite;
    }
    
    .ai-button:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.5) !important;
    }
    
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background: var(--surface-color);
      min-width: 200px;
      box-shadow: var(--shadow-elevated);
      z-index: 10;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      top: 100%;
      left: 0;
      overflow: hidden;
      animation: fadeIn 0.2s ease;
    }
    
    .dropdown-content button {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
      margin: 0;
      padding: 14px 18px;
      background: var(--surface-color);
      color: var(--text-primary);
      transition: background 0.2s ease;
    }
    
    .dropdown-content button:hover {
      background: rgba(66, 133, 244, 0.06);
      transform: none;
    }
    
    .dropdown:hover .dropdown-content { display: block; }
    
    #pad {
      width: 100%;
      height: 60vh;
      padding: 24px;
      font-family: 'Product Sans', 'Montserrat', sans-serif !important;
      font-size: 18px !important;
      line-height: 1.7 !important;
      letter-spacing: 0.3px;
      border: none;
      outline: none;
      resize: none;
      box-sizing: border-box;
      background: var(--surface-color);
      color: var(--text-primary);
      position: relative;
      flex: 1;
    }
    
    #pad:focus {
      background: #fafbff;
      box-shadow: inset 0 2px 4px rgba(66, 133, 244, 0.1);
    }
    
    /* NEW: Voice-to-Text Feature */
    #voice-to-text {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--premiere);
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
      transition: all 0.3s ease;
      z-index: 100;
    }
    
    #voice-to-text:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(236, 72, 153, 0.6);
    }
    
    #voice-to-text.recording {
      background: var(--error-color);
      animation: pulse 1s infinite;
    }
    
    /* NEW: Collaboration Panel */
    #collaboration-panel {
      position: fixed;
      right: -300px;
      top: 50%;
      transform: translateY(-50%);
      width: 280px;
      height: 400px;
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 15px 0 0 15px;
      box-shadow: var(--shadow-elevated);
      transition: right 0.3s ease;
      z-index: 50;
    }
    
    #collaboration-panel.open { right: 0; }
    
    #collaboration-toggle {
      position: absolute;
      left: -40px;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 80px;
      background: var(--premiere);
      color: white;
      border: none;
      border-radius: 8px 0 0 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 60vh;
      background: var(--surface-color);
      color: var(--text-secondary);
      text-align: center;
      padding: 40px;
    }
    
    .empty-state i {
      font-size: 72px;
      background: var(--premiere);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 28px;
    }
    
    .empty-state h3 {
      margin: 0 0 18px 0;
      color: var(--text-primary);
      font-size: 24px;
    }
    
    .empty-state p {
      margin: 0;
      max-width: 450px;
      font-size: 16px;
    }
    
    #rhymes {
      padding: 24px 28px;
      font-size: 14px;
      background: var(--surface-color);
      border-top: 1px solid var(--border-color);
      color: var(--text-secondary);
      min-height: 70px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 18px;
      box-shadow: var(--shadow);
    }
    
    #stats-mini {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 18px;
      min-width: 350px;
    }
    
    .stat-item {
      text-align: center;
      padding: 12px;
      background: rgba(66, 133, 244, 0.06);
      border-radius: 10px;
      border: 1px solid rgba(66, 133, 244, 0.1);
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
      background: var(--premiere);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
      font-weight: 500;
    }
    
    #focusModeToggle {
      position: fixed;
      top: 30px;
      right: 30px;
      z-index: 999;
      background: var(--premiere);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 15px 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow-elevated);
      transition: all 0.3s ease;
      display: none;
      align-items: center;
      gap: 8px;
    }
    
    body.focus-mode #focusModeToggle {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      backdrop-filter: blur(6px);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .modal.show { opacity: 1; }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: var(--surface-color);
      padding: 35px;
      border-radius: 15px;
      width: 90%;
      max-width: 750px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 70px rgba(0,0,0,0.25);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .modal.show .modal-content {
      transform: translate(-50%, -50%) scale(1);
      animation: modalSlideIn 0.3s ease;
    }
    
    /* STREAMLINED: 4 Essential Settings Tabs */
    .settings-tabs {
      display: flex;
      margin-bottom: 28px;
      border-bottom: 3px solid var(--border-color);
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .settings-tab {
      padding: 15px 25px;
      cursor: pointer;
      border-bottom: 4px solid transparent;
      flex-shrink: 0;
      transition: all 0.2s ease;
      border-radius: 8px 8px 0 0;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
    }
    
    .settings-tab:hover { background: rgba(66, 133, 244, 0.06); }
    
    .settings-tab.active {
      border-bottom-color: var(--primary-color);
      background: var(--premiere);
      color: white;
      border-radius: 8px;
    }
    
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }
    
    .button-toggle {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
      margin: 25px 0;
    }
    
    .button-toggle label {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(66, 133, 244, 0.06);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .button-toggle label:hover {
      background: rgba(66, 133, 244, 0.1);
    }
    
    .ai-processing {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      background: var(--premiere);
      color: white;
      border-radius: 25px;
      font-size: 14px;
      animation: premiereGlow 2s infinite;
      font-weight: 600;
    }
    
    .ai-processing::before {
      content: "🧠";
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }
    
    body.dark {
      --surface-color: #1f1f1f;
      --background-color: #121212;
      --text-primary: #e8eaed;
      --text-secondary: #9aa0a6;
      --border-color: #3c4043;
    }
    
    body.focus-mode #controls,
    body.focus-mode #tabs-container,
    body.focus-mode header,
    body.focus-mode #rhymes,
    body.focus-mode .lifetime-banner {
      display: none;
    }
    
    body.focus-mode #pad { height: 100vh; border: none; }
    body.focus-mode .empty-state { height: 100vh; }
    body.focus-mode #editor-container { height: 100vh; }
    
    @media (max-width: 768px) {
      .version-pro { display: none; }
      .donate-btn { position: relative; top: 0; left: 0; margin: 10px auto; display: flex; }
      #controls { flex-direction: column; align-items: stretch; gap: 10px; }
      .modal-content { width: 95%; padding: 25px; }
      #pad { font-size: 16px !important; }
      .logo-line { font-size: 32px; }
      .tab { min-width: 90px; max-width: 130px; padding: 8px 10px; font-size: 12px; }
      #line-numbers, #syllable-counter { width: 50px; font-size: 10px; }
      #voice-to-text { width: 50px; height: 50px; font-size: 20px; bottom: 20px; right: 20px; }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
</head>
<body>
  <!-- Enhanced Premiere Banner -->
  <div id="lifetimeBanner" class="lifetime-banner">
    <div class="lifetime-text">
      <i class="fas fa-crown"></i>
      <span class="lifetime-highlight">v2.5 PREMIERE</span>
      <span>Industry-Leading Features • Forever Free • Ultimate Edition</span>
      <i class="fas fa-infinity"></i>
    </div>
    <div class="close-btn" onclick="closeBanner()" title="Close banner">×</div>
  </div>

  <!-- Donation Modal -->
  <div id="donateModal" class="donate-modal">
    <div class="donate-content">
      <div style="color: var(--primary-color); font-size: 26px; font-weight: 700; margin-bottom: 18px;">
        <i class="fas fa-heart"></i> Support LiLyrics v2.5 Premiere
      </div>
      <div style="font-size: 18px; color: var(--text-secondary); margin: 22px 0;">
        Your donations help us develop cutting-edge songwriting features!
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 25px 0;">
        <button onclick="donateAmount(50)" style="padding: 18px; border: 2px solid var(--primary-color); border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; background: white; color: var(--primary-color);">
          ₹50
        </button>
        <button onclick="donateAmount(100)" style="padding: 18px; border: 2px solid var(--secondary-color); border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; background: var(--secondary-color); color: white;">
          ₹100 ⭐
        </button>
        <button onclick="donateAmount(299)" style="padding: 18px; border: 2px solid var(--warning-color); border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; background: var(--warning-color); color: white;">
          ₹299 👑
        </button>
      </div>
      
      <div style="margin: 25px 0;">
        <input type="number" id="customAmount" placeholder="Custom Amount (₹)" style="width: 220px; padding: 15px; border: 2px solid var(--border-color); border-radius: 10px; text-align: center; font-size: 16px;">
        <button onclick="donateCustomAmount()" style="padding: 15px 25px; background: var(--premiere); color: white; border: none; border-radius: 10px; cursor: pointer; margin-left: 10px;">
          <i class="fas fa-heart"></i> Donate
        </button>
      </div>
      
      <div style="margin: 25px 0; padding: 20px; background: #f0f8ff; border-radius: 10px; border-left: 5px solid var(--primary-color);">
        <strong>UPI ID:</strong> lilaanas6-3@okicici<br>
        <strong>Note:</strong> LiLyrics v2.5 Premiere Support<br>
        <small style="color: var(--text-secondary);">Thank you for supporting innovation! 👑</small>
      </div>
      
      <button onclick="hideDonateModal()" style="background: #666; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; margin-top: 20px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <header>
    <button class="donate-btn" onclick="showDonateModal()" title="Support LiLyrics v2.5 Premiere">
      <i class="fas fa-heart"></i> Support Us
    </button>
    
    <div class="logo-line">
      <img src="https://cdn-icons-png.flaticon.com/512/14384/14384748.png" alt="Lyrics Icon"/>
      <span>LiLyrics</span>
      <div class="version-pro">v2.5 PREMIERE</div>
    </div>
    <div class="tagline">Ultimate Songwriting Studio - Industry-Leading & Forever Free!</div>
    <button id="darkToggle" title="Toggle dark mode"><i class="fas fa-moon"></i></button>
  </header>
  
  <div id="tabs-container">
    <div id="tabs"></div>
    <div id="addNewTab" title="New Untitled Lyrics">
      <i class="fas fa-plus"></i>
    </div>
  </div>
  
  <button id="focusModeToggle" onclick="toggleFocusMode()" title="Exit Focus Mode">
    <i class="fas fa-edit"></i> Writing Mode
  </button>
  
  <div id="controls">
    <div class="dropdown" id="fileDropdown">
      <button><i class="fas fa-folder"></i> File</button>
      <div class="dropdown-content">
        <button onclick="saveToFile()"><i class="fas fa-save"></i> Save as TXT</button>
        <button onclick="document.getElementById('fileInput').click()"><i class="fas fa-folder-open"></i> Open File</button>
        <button onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
        <button onclick="exportAllProjects()"><i class="fas fa-download"></i> Export All Projects</button>
      </div>
    </div>
    
    <button id="undoBtn" onclick="undo()"><i class="fas fa-undo"></i> Undo</button>
    <button id="redoBtn" onclick="redo()"><i class="fas fa-redo"></i> Redo</button>
    
    <input type="search" id="searchBox" placeholder="Search lyrics...">
    <input type="file" id="fileInput" style="display:none" accept=".txt,.json" onchange="loadFromFile(event)"/>
    
    <!-- NEW: Enhanced AI Features -->
    <button id="rhymeBtn" onclick="promptSuggestRhymes()" class="ai-button"><i class="fas fa-brain"></i> AI Mega Rhymes</button>
    <button id="lyricGenBtn" onclick="generateLyrics()" class="ai-button"><i class="fas fa-magic"></i> AI Lyric Generator</button>
    <button id="nearRhymeBtn" onclick="findNearRhymes()" class="ai-button"><i class="fas fa-search-plus"></i> Near Rhymes</button>
    
    <button id="inspireBtn" onclick="showInspireModal()"><i class="fas fa-lightbulb"></i> Inspire Me</button>
    <button id="voiceBtn" onclick="toggleVoiceRecording()"><i class="fas fa-microphone"></i> Voice Memo</button>
    <button id="focusBtn" onclick="toggleFocusMode()"><i class="fas fa-bullseye"></i> Focus Mode</button>
    <button id="settingsBtn" onclick="showSettings()"><i class="fas fa-cog"></i> Settings</button>
    
    <!-- NEW: Collaboration Toggle -->
    <button id="collaborateBtn" onclick="toggleCollaboration()"><i class="fas fa-users"></i> Collaborate</button>
  </div>
  
  <!-- NEW: Enhanced Editor with Syllable Counter -->
  <div id="editor-container">
    <div id="line-numbers"></div>
    <div id="syllable-counter"></div>
    <div id="mainContent">
      <button id="dashboardNewTab" style="display: none;">
        <i class="fas fa-plus"></i> Create New Project
      </button>
    </div>
  </div>
  
  <!-- NEW: Voice-to-Text Button -->
  <button id="voice-to-text" onclick="toggleVoiceToText()" title="Voice to Text">
    <i class="fas fa-microphone"></i>
  </button>
  
  <!-- NEW: Collaboration Panel -->
  <div id="collaboration-panel">
    <button id="collaboration-toggle" onclick="toggleCollaboration()">
      <i class="fas fa-users"></i>
    </button>
    <div style="padding: 20px;">
      <h3><i class="fas fa-users"></i> Collaboration</h3>
      <div id="collaboration-content">
        <p>Share your project link:</p>
        <input type="text" id="share-link" readonly style="width: 100%; margin: 10px 0; padding: 8px;">
        <button onclick="generateShareLink()" style="width: 100%; padding: 10px; background: var(--premiere); color: white; border: none; border-radius: 6px; cursor: pointer;">
          <i class="fas fa-link"></i> Generate Link
        </button>
        
        <div style="margin-top: 20px;">
          <h4>Comments:</h4>
          <div id="comments-list" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px; margin: 10px 0;">
            <p style="color: var(--text-secondary); font-style: italic;">No comments yet...</p>
          </div>
          <input type="text" id="comment-input" placeholder="Add a comment..." style="width: 100%; padding: 8px; margin: 5px 0;">
          <button onclick="addComment()" style="width: 100%; padding: 8px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-comment"></i> Add Comment
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="rhymes">
    <div id="rhyme-suggestions"></div>
    <div id="stats-mini">
      <div class="stat-item">
        <div class="stat-value" id="word-count">0</div>
        <div class="stat-label">Words</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="char-count">0</div>
        <div class="stat-label">Characters</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="line-count">0</div>
        <div class="stat-label">Lines</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="syllable-total">0</div>
        <div class="stat-label">Syllables</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="session-time">0m</div>
        <div class="stat-label">Session</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="current-file-name">No Project</div>
        <div class="stat-label">Current Project</div>
      </div>
    </div>
  </div>

  <!-- Enhanced Inspiration Modal -->
  <div id="inspireModal" class="modal">
    <div class="modal-content">
      <h2><i class="fas fa-lightbulb"></i> Creative Inspiration Hub (2000+ Prompts)</h2>
      <div id="inspireContent" style="max-height: 450px; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 10px; margin: 20px 0;">
        Loading inspiration...
      </div>
      <button onclick="getNewInspiration()" style="background: var(--premiere); color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; margin: 10px;">
        <i class="fas fa-sync"></i> New Inspiration
      </button>
      <button onclick="hideInspireModal()" style="background: #666; color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; margin: 10px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <!-- Streamlined Settings Modal (4 Tabs) -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="settings-tabs">
        <div class="settings-tab active" onclick="showSettingsTab('interface')"><i class="fas fa-desktop"></i> Interface</div>
        <div class="settings-tab" onclick="showSettingsTab('ai-features')"><i class="fas fa-brain"></i> AI Features</div>
        <div class="settings-tab" onclick="showSettingsTab('shortcuts')"><i class="fas fa-keyboard"></i> Shortcuts</div>
        <div class="settings-tab" onclick="showSettingsTab('about')"><i class="fas fa-info-circle"></i> About</div>
      </div>
      
      <div id="interface-panel" class="settings-panel active">
        <h3><i class="fas fa-desktop"></i> Customize Interface</h3>
        <p>Show/Hide features to customize your workspace:</p>
        <div class="button-toggle">
          <label>
            <input type="checkbox" id="toggle-undo" checked onchange="toggleButton('undoBtn', this.checked)">
            <i class="fas fa-undo"></i> Undo/Redo Buttons
          </label>
          <label>
            <input type="checkbox" id="toggle-voice" checked onchange="toggleButton('voiceBtn', this.checked)">
            <i class="fas fa-microphone"></i> Voice Memo
          </label>
          <label>
            <input type="checkbox" id="toggle-syllables" checked onchange="toggleSyllableCounter(this.checked)">
            <i class="fas fa-list-ol"></i> Syllable Counter
          </label>
          <label>
            <input type="checkbox" id="toggle-line-numbers" checked onchange="toggleLineNumbers(this.checked)">
            <i class="fas fa-list-ol"></i> Line Numbers
          </label>
          <label>
            <input type="checkbox" id="toggle-collaboration" checked onchange="toggleButton('collaborateBtn', this.checked)">
            <i class="fas fa-users"></i> Collaboration
          </label>
          <label>
            <input type="checkbox" id="toggle-focus" checked onchange="toggleButton('focusBtn', this.checked)">
            <i class="fas fa-bullseye"></i> Focus Mode
          </label>
        </div>
        
        <h4>Enhanced Templates (12 Available)</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin: 20px 0;">
          <button onclick="insertTemplate('verse-chorus')" style="padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-music"></i><br><strong>Verse-Chorus</strong>
          </button>
          <button onclick="insertTemplate('rap')" style="padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-microphone-alt"></i><br><strong>Rap</strong>
          </button>
          <button onclick="insertTemplate('ballad')" style="padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-heart"></i><br><strong>Ballad</strong>
          </button>
          <button onclick="insertTemplate('hindi')" style="padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-globe-asia"></i><br><strong>Hindi</strong>
          </button>
          <button onclick="insertTemplate('edm')" style="padding: 12px; background: var(--premiere); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-bolt"></i><br><strong>EDM</strong>
          </button>
          <button onclick="insertTemplate('country')" style="padding: 12px; background: var(--premiere); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-guitar"></i><br><strong>Country</strong>
          </button>
        </div>
      </div>
      
      <div id="ai-features-panel" class="settings-panel">
        <h3><i class="fas fa-brain"></i> AI Features Configuration</h3>
        <div style="margin: 25px 0;">
          <label style="display: block; margin: 18px 0; font-size: 16px;"><input type="checkbox" id="ai-suggestions" checked> Real-time AI suggestions</label>
          <label style="display: block; margin: 18px 0; font-size: 16px;"><input type="checkbox" id="smart-rhymes" checked> Smart rhyme detection</label>
          <label style="display: block; margin: 18px 0; font-size: 16px;"><input type="checkbox" id="context-aware" checked> Context-aware generation</label>
          <label style="display: block; margin: 18px 0; font-size: 16px;"><input type="checkbox" id="emotion-analysis" checked> Emotion-based analysis</label>
        </div>
        
        <h4>AI Lyric Generator Settings</h4>
        <div style="margin: 20px 0;">
          <label style="display: block; margin: 10px 0;">
            Genre Preference: 
            <select id="ai-genre" style="margin-left: 10px; padding: 8px;">
              <option value="any">Any Genre</option>
              <option value="pop">Pop</option>
              <option value="rock">Rock</option>
              <option value="hip-hop">Hip-Hop</option>
              <option value="country">Country</option>
              <option value="electronic">Electronic</option>
            </select>
          </label>
          <label style="display: block; margin: 10px 0;">
            Creativity Level: 
            <input type="range" id="creativity-level" min="1" max="10" value="7" style="margin-left: 10px;">
            <span id="creativity-value">7</span>
          </label>
        </div>
        
        <button onclick="testAIFeatures()" style="background: var(--premiere); color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; margin: 15px 0; display: block;">
          <i class="fas fa-magic"></i> Test AI Features
        </button>
      </div>
      
      <div id="shortcuts-panel" class="settings-panel">
        <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>New Project</span>
            <strong>Ctrl + N</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>Save Project</span>
            <strong>Ctrl + S</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>AI Rhymes</span>
            <strong>Ctrl + R</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>AI Generator</span>
            <strong>Ctrl + G</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>Voice to Text</span>
            <strong>Ctrl + M</strong>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
            <span>Focus Mode</span>
            <strong>F11</strong>
          </div>
        </div>
        
        <div style="margin-top: 25px; padding: 20px; background: #f0f8ff; border-radius: 10px;">
          <h4><i class="fas fa-keyboard"></i> Text Formatting Shortcuts</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
              <span>Bold Text</span>
              <strong>Ctrl + B</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
              <span>Italic Text</span>
              <strong>Ctrl + I</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
              <span>Underline Text</span>
              <strong>Ctrl + U</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px; background: rgba(66, 133, 244, 0.06); border-radius: 6px;">
              <span>Select All</span>
              <strong>Ctrl + A</strong>
            </div>
          </div>
        </div>
      </div>
      
      <div id="about-panel" class="settings-panel">
        <h3><i class="fas fa-crown"></i> About LiLyrics v2.5 Premiere</h3>
        <div style="text-align: center; margin: 25px 0;">
          <i class="fas fa-crown" style="font-size: 64px; background: var(--premiere); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 20px;"></i>
          <h4 style="font-size: 24px;">Ultimate Songwriting Studio</h4>
        </div>
        
        <div style="background: var(--premiere); color: white; padding: 25px; border-radius: 15px; margin: 25px 0;">
          <h4 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px; font-size: 18px;">
            <i class="fas fa-user-tie"></i> Developer Information
          </h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 15px;">
            <div>
              <strong>👨‍💻 Developed by:</strong><br>
              Anas Lila
            </div>
            <div>
              <strong>🏢 Company:</strong><br>
              AL Softwares
            </div>
            <div>
              <strong>⚡ Built with:</strong><br>
              HTML5, CSS3, Advanced JavaScript
            </div>
            <div>
              <strong>📅 Released:</strong><br>
              July 31, 2025
            </div>
            <div>
              <strong>🎯 Version:</strong><br>
              v2.5 Premiere - Ultimate Edition
            </div>
            <div>
              <strong>🔧 Framework:</strong><br>
              Softr Technologies Pro
            </div>
          </div>
        </div>
        
        <h4>🆕 New in v2.5 Premiere:</h4>
        <ul style="text-align: left; margin: 25px 0; font-size: 15px; line-height: 1.8;">
          <li><i class="fas fa-crown"></i> <strong>Syllable Counter:</strong> Real-time syllable counting for perfect rhythm</li>
          <li><i class="fas fa-magic"></i> <strong>AI Lyric Generator:</strong> Complete verse/chorus generation</li>
          <li><i class="fas fa-search-plus"></i> <strong>Near Rhymes:</strong> Advanced rhyme suggestions beyond perfect matches</li>
          <li><i class="fas fa-microphone"></i> <strong>Voice-to-Text:</strong> Speak your lyrics directly into the editor</li>
          <li><i class="fas fa-users"></i> <strong>Collaboration:</strong> Real-time co-writing with comments</li>
          <li><i class="fas fa-list-ol"></i> <strong>Line Numbers:</strong> Professional editor with line tracking</li>
          <li><i class="fas fa-brain"></i> <strong>Enhanced AI:</strong> Context-aware suggestions and emotion analysis</li>
          <li><i class="fas fa-templates"></i> <strong>12+ Templates:</strong> Genre-specific song structures</li>
          <li><i class="fas fa-mobile-alt"></i> <strong>Mobile Optimized:</strong> Perfect experience on all devices</li>
          <li><i class="fas fa-infinity"></i> <strong>Forever Free:</strong> All premium features at no cost</li>
        </ul>
        
        <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 25px 0; color: #155724;">
          <i class="fas fa-crown"></i> <strong>v2.5 Premiere Edition:</strong> Industry-leading songwriting platform with cutting-edge AI features. Forever free with optional donations to support continuous innovation.
        </div>
        
        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px;">
          <i class="fas fa-heart"></i> <strong>Developed with ❤️ by Anas Lila @ AL Softwares.</strong> This ultimate edition represents the pinnacle of free songwriting software in 2025.
        </div>
      </div>
      
      <br>
      <button onclick="hideSettings()" style="background: var(--premiere); color: white; padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px;">
        <i class="fas fa-times"></i> Close Settings
      </button>
    </div>
  </div>

  <!-- Enhanced Voice Recording Modal -->
  <div id="voiceModal" class="modal">
    <div class="modal-content" style="text-align: center;">
      <h3><i class="fas fa-microphone"></i> Voice Memo Studio</h3>
      <p id="recording-status">Click to start recording your ideas</p>
      <button id="record-btn" style="width: 100px; height: 100px; border-radius: 50%; background: var(--premiere); color: white; border: none; font-size: 32px; cursor: pointer; margin: 25px; transition: all 0.3s;" onclick="toggleRecording()">
        <i class="fas fa-microphone"></i>
      </button>
      <div id="recordings-list" style="margin-top: 25px;"></div>
      <button onclick="hideVoiceModal()" style="background: var(--premiere); color: white; padding: 12px 25px; margin: 15px; border: none; border-radius: 8px; cursor: pointer;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <script>
    // ===== LILYRICS v2.5 PREMIERE - ULTIMATE EDITION =====
    
    let pad = null;
    const rhymes = document.getElementById('rhyme-suggestions');
    const searchBox = document.getElementById('searchBox');
    let projects = JSON.parse(localStorage.getItem('lyricProjects')) || {};
    let current = null;
    let untitledCounter = 1;
    
    let sessionStartTime = Date.now();
    let isRecording = false;
    let mediaRecorder = null;
    let recordedChunks = [];
    let focusModeEnabled = false;
    let isVoiceToText = false;
    let recognitionService = null;
    let collaborationOpen = false;
    
    let stats = JSON.parse(localStorage.getItem('lyricsStats')) || {
      totalWords: 0,
      dailyWords: {},
      streak: 0,
      lastWriteDate: null,
      totalProjects: 0,
      totalSyllables: 0
    };
    
    let undoStack = [];
    let redoStack = [];

    // ===== NEW: SYLLABLE COUNTING SYSTEM =====
    function countSyllables(word) {
      if (!word || word.length === 0) return 0;
      word = word.toLowerCase();
      let syllableCount = 0;
      let previousWasVowel = false;
      
      for (let i = 0; i < word.length; i++) {
        const isVowel = 'aeiouy'.includes(word[i]);
        if (isVowel && !previousWasVowel) {
          syllableCount++;
        }
        previousWasVowel = isVowel;
      }
      
      // Handle silent 'e'
      if (word.endsWith('e') && syllableCount > 1) {
        syllableCount--;
      }
      
      return Math.max(1, syllableCount);
    }
    
    function updateSyllableCounter() {
      if (!pad) return;
      
      const lines = pad.value.split('\n');
      const syllableCounter = document.getElementById('syllable-counter');
      const lineNumbers = document.getElementById('line-numbers');
      
      if (!syllableCounter || !lineNumbers) return;
      
      let syllableHTML = '';
      let lineHTML = '';
      let totalSyllables = 0;
      
      lines.forEach((line, index) => {
        const words = line.trim().split(/\s+/).filter(w => w.length > 0);
        const lineSyllables = words.reduce((sum, word) => {
          const cleanWord = word.replace(/[^\w]/g, '');
          return sum + countSyllables(cleanWord);
        }, 0);
        
        totalSyllables += lineSyllables;
        syllableHTML += `<div>${lineSyllables || ''}</div>`;
        lineHTML += `<div>${index + 1}</div>`;
      });
      
      syllableCounter.innerHTML = syllableHTML;
      lineNumbers.innerHTML = lineHTML;
      
      // Update stats
      document.getElementById('syllable-total').textContent = totalSyllables;
      stats.totalSyllables = totalSyllables;
      saveProjects();
    }
    
    function toggleSyllableCounter(show) {
      const counter = document.getElementById('syllable-counter');
      if (counter) {
        counter.style.display = show ? 'block' : 'none';
      }
      localStorage.setItem('syllableCounterEnabled', show);
    }
    
    function toggleLineNumbers(show) {
      const lineNumbers = document.getElementById('line-numbers');
      if (lineNumbers) {
        lineNumbers.style.display = show ? 'block' : 'none';
      }
      localStorage.setItem('lineNumbersEnabled', show);
    }

    // ===== NEW: ENHANCED AI LYRIC GENERATOR =====
    const aiLyricTemplates = {
      'pop': {
        themes: ['love', 'heartbreak', 'dreams', 'summer', 'freedom', 'youth', 'party', 'friendship'],
        patterns: [
          'Every {time} I {action}, I think of {object}',
          'We were {adjective} and {adjective}, dancing through the {time}',
          'In the {place} where we first met, I still {action} you',
          '{Emotion} fills my heart when I {action} your {object}'
        ]
      },
      'rock': {
        themes: ['rebellion', 'power', 'struggle', 'freedom', 'passion', 'thunder', 'fire', 'storm'],
        patterns: [
          'Breaking through the {object} with {emotion} in my soul',
          'Thunder roars as we {action} into the {time}',
          'No chains can hold this {emotion} burning inside',
          'Rise up and {action} against the {object} of {emotion}'
        ]
      },
      'hip-hop': {
        themes: ['struggle', 'success', 'streets', 'hustle', 'dreams', 'money', 'respect', 'grind'],
        patterns: [
          'Started from the {place}, now we {action} every day',
          'Money on my mind, {emotion} in my heart',
          'They said I couldn\'t {action}, but I proved them wrong',
          'From the {place} to the top, never gonna stop'
        ]
      }
    };
    
    const lyricWords = {
      'time': ['night', 'day', 'morning', 'evening', 'moment', 'lifetime', 'second', 'hour'],
      'action': ['dance', 'sing', 'dream', 'fly', 'run', 'fight', 'love', 'believe'],
      'object': ['stars', 'moon', 'sun', 'ocean', 'sky', 'heart', 'soul', 'memories'],
      'adjective': ['young', 'wild', 'free', 'brave', 'strong', 'beautiful', 'endless', 'bright'],
      'emotion': ['love', 'passion', 'fire', 'hope', 'dreams', 'strength', 'power', 'energy'],
      'place': ['city', 'hometown', 'street', 'stage', 'world', 'bedroom', 'rooftop', 'beach']
    };
    
    function generateLyrics() {
      if (!pad) {
        alert('Please create or open a project first!');
        return;
      }
      
      const genre = document.getElementById('ai-genre')?.value || 'pop';
      const creativity = parseInt(document.getElementById('creativity-level')?.value || 7);
      
      let aiGenre = aiLyricTemplates[genre] || aiLyricTemplates['pop'];
      
      rhymes.innerHTML = `
        <div class="ai-processing">
          AI is generating context-aware lyrics based on your preferences...
        </div>
      `;
      
      setTimeout(() => {
        const numLines = Math.min(4 + creativity, 8);
        let generatedLines = [];
        
        for (let i = 0; i < numLines; i++) {
          let pattern = aiGenre.patterns[Math.floor(Math.random() * aiGenre.patterns.length)];
          
          // Replace placeholders with random words
          Object.keys(lyricWords).forEach(category => {
            const regex = new RegExp(`{${category}}`, 'g');
            const word = lyricWords[category][Math.floor(Math.random() * lyricWords[category].length)];
            pattern = pattern.replace(regex, word);
          });
          
          // Handle emotion and capitalize
          pattern = pattern.replace(/{Emotion}/g, () => {
            const emotion = lyricWords['emotion'][Math.floor(Math.random() * lyricWords['emotion'].length)];
            return emotion.charAt(0).toUpperCase() + emotion.slice(1);
          });
          
          generatedLines.push(pattern);
        }
        
        const generatedText = generatedLines.join('\n');
        
        rhymes.innerHTML = `
          <div style="margin-bottom: 20px;">
            <strong><i class="fas fa-magic"></i> AI Generated Lyrics (${genre.toUpperCase()} style):</strong>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
              <i class="fas fa-brain"></i> Creativity Level: ${creativity}/10 • Context-Aware Generation
            </div>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid var(--primary-color);">
            <pre style="font-family: inherit; white-space: pre-wrap; margin: 0; font-size: 14px; line-height: 1.6;">${generatedText}</pre>
            <button onclick="insertText('\\n\\n${generatedText.replace(/'/g, "\\'")}\\n')" style="margin-top: 15px; padding: 10px 20px; background: var(--premiere); color: white; border: none; border-radius: 6px; cursor: pointer;">
              <i class="fas fa-plus"></i> Add to Lyrics
            </button>
            <button onclick="copyToClipboard('${generatedText.replace(/'/g, "\\'")}\')" style="margin: 15px 0 0 10px; padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        `;
      }, 2500);
    }

    // ===== NEW: NEAR RHYMES & ADVANCED RHYME ANALYSIS =====
    const nearRhymePatterns = {
      'consonant': { // Same ending consonant sound
        'ight': ['ate', 'eet', 'oot', 'ite'],
        'ove': ['ave', 'ive', 'eve'],
        'art': ['ort', 'urt', 'ert'],
        'ound': ['and', 'end', 'ind']
      },
      'vowel': { // Same vowel sound
        'ay': ['ai', 'ei', 'ey'],
        'oo': ['ue', 'ew', 'ou'],
        'ee': ['ea', 'ie', 'ei'],
        'ow': ['au', 'ou', 'aw']
      }
    };
    
    function findNearRhymes() {
      const word = prompt('🔍 Enter a word for Near Rhyme Analysis:');
      if (!word) return;
      
      const searchWord = word.toLowerCase().trim();
      
      rhymes.innerHTML = `
        <div class="ai-processing">
          Analyzing phonetic patterns for near rhymes and slant rhymes...
        </div>
      `;
      
      setTimeout(() => {
        let nearRhymes = [];
        let slantRhymes = [];
        
        // Get exact rhymes first
        const exactRhymes = megaAIRhymes[searchWord] || [];
        
        // Generate near rhymes based on word endings
        const ending = searchWord.slice(-2);
        Object.keys(megaAIRhymes).forEach(key => {
          if (key !== searchWord) {
            const keyEnding = key.slice(-2);
            // Phonetic similarity check
            if (ending[1] === keyEnding[1] || ending[0] === keyEnding[0]) {
              nearRhymes = nearRhymes.concat(megaAIRhymes[key].slice(0, 3));
            }
          }
        });
        
        // Generate slant rhymes (similar sound structure)
        const vowels = 'aeiou';
        Object.keys(megaAIRhymes).forEach(key => {
          if (key !== searchWord && key.length === searchWord.length) {
            let similarity = 0;
            for (let i = 0; i < Math.min(key.length, searchWord.length); i++) {
              if (key[i] === searchWord[i]) similarity++;
              else if (vowels.includes(key[i]) && vowels.includes(searchWord[i])) similarity += 0.5;
            }
            if (similarity >= searchWord.length * 0.6) {
              slantRhymes = slantRhymes.concat(megaAIRhymes[key].slice(0, 2));
            }
          }
        });
        
        // Remove duplicates and limit results
        nearRhymes = [...new Set(nearRhymes)].slice(0, 8);
        slantRhymes = [...new Set(slantRhymes)].slice(0, 6);
        
        rhymes.innerHTML = `
          <div style="margin-bottom: 20px;">
            <strong><i class="fas fa-search-plus"></i> Advanced Rhyme Analysis for "${word}":</strong>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
              <i class="fas fa-brain"></i> Perfect + Near + Slant Rhymes • Phonetic Analysis
            </div>
          </div>
          
          ${exactRhymes.length > 0 ? `
          <div style="margin: 15px 0;">
            <h4 style="margin: 10px 0; color: var(--primary-color);">Perfect Rhymes:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              ${exactRhymes.slice(0, 6).map(rhyme => 
                `<button onclick="insertText(' ${rhyme}')" style="padding: 6px 12px; background: var(--primary-color); color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                  ${rhyme}
                </button>`
              ).join('')}
            </div>
          </div>` : ''}
          
          ${nearRhymes.length > 0 ? `
          <div style="margin: 15px 0;">
            <h4 style="margin: 10px 0; color: var(--secondary-color);">Near Rhymes:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              ${nearRhymes.map(rhyme => 
                `<button onclick="insertText(' ${rhyme}')" style="padding: 6px 12px; background: var(--secondary-color); color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                  ${rhyme}
                </button>`
              ).join('')}
            </div>
          </div>` : ''}
          
          ${slantRhymes.length > 0 ? `
          <div style="margin: 15px 0;">
            <h4 style="margin: 10px 0; color: var(--warning-color);">Slant Rhymes:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              ${slantRhymes.map(rhyme => 
                `<button onclick="insertText(' ${rhyme}')" style="padding: 6px 12px; background: var(--warning-color); color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                  ${rhyme}
                </button>`
              ).join('')}
            </div>
          </div>` : ''}
        `;
      }, 2000);
    }

    // ===== NEW: VOICE-TO-TEXT SYSTEM =====
    function initializeVoiceToText() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognitionService = new SpeechRecognition();
        
        recognitionService.continuous = true;
        recognitionService.interimResults = true;
        recognitionService.lang = 'en-US';
        
        recognitionService.onresult = function(event) {
          let finalTranscript = '';
          let interimTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          if (finalTranscript && pad) {
            const currentText = pad.value;
            const cursorPos = pad.selectionStart;
            pad.value = currentText.slice(0, cursorPos) + finalTranscript + ' ' + currentText.slice(cursorPos);
            pad.focus();
            
            if (current) {
              projects[current] = pad.value;
              saveProjects();
              trackChange(pad.value);
              updateStats();
              updateSyllableCounter();
            }
          }
        };
        
        recognitionService.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          stopVoiceToText();
        };
        
        recognitionService.onend = function() {
          if (isVoiceToText) {
            // Restart if still in voice-to-text mode
            recognitionService.start();
          }
        };
      }
    }
    
    function toggleVoiceToText() {
      if (!recognitionService) {
        alert('Voice recognition not supported in your browser. Try Chrome or Edge.');
        return;
      }
      
      if (!pad) {
        alert('Please create or open a project first!');
        return;
      }
      
      if (isVoiceToText) {
        stopVoiceToText();
      } else {
        startVoiceToText();
      }
    }
    
    function startVoiceToText() {
      isVoiceToText = true;
      const button = document.getElementById('voice-to-text');
      button.classList.add('recording');
      button.innerHTML = '<i class="fas fa-stop"></i>';
      button.title = 'Stop Voice to Text';
      
      try {
        recognitionService.start();
        
        // Show visual feedback
        rhymes.innerHTML = `
          <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary-color);">
            <strong><i class="fas fa-microphone"></i> Voice-to-Text Active</strong><br>
            <small>Speak naturally and your words will appear in the editor. Click the stop button when finished.</small>
          </div>
        `;
      } catch (error) {
        console.error('Error starting voice recognition:', error);
        stopVoiceToText();
      }
    }
    
    function stopVoiceToText() {
      isVoiceToText = false;
      const button = document.getElementById('voice-to-text');
      button.classList.remove('recording');
      button.innerHTML = '<i class="fas fa-microphone"></i>';
      button.title = 'Voice to Text';
      
      if (recognitionService) {
        recognitionService.stop();
      }
      
      rhymes.innerHTML = '';
    }

    // ===== NEW: COLLABORATION SYSTEM =====
    function toggleCollaboration() {
      collaborationOpen = !collaborationOpen;
      const panel = document.getElementById('collaboration-panel');
      if (collaborationOpen) {
        panel.classList.add('open');
      } else {
        panel.classList.remove('open');
      }
    }
    
    function generateShareLink() {
      if (!current) {
        alert('Please create or open a project first!');
        return;
      }
      
      // Generate a unique share ID based on project name and timestamp
      const shareId = btoa(current + '_' + Date.now()).replace(/[^a-zA-Z0-9]/g, '').substring(0, 12);
      const shareLink = `${window.location.origin}${window.location.pathname}?share=${shareId}`;
      
      document.getElementById('share-link').value = shareLink;
      
      // Store share data
      const shareData = {
        projectName: current,
        content: pad ? pad.value : '',
        created: new Date().toISOString(),
        comments: []
      };
      localStorage.setItem(`share_${shareId}`, JSON.stringify(shareData));
      
      alert('✅ Share link generated! Copy and send to collaborators.');
    }
    
    function addComment() {
      const commentInput = document.getElementById('comment-input');
      const commentText = commentInput.value.trim();
      
      if (!commentText) {
        alert('Please enter a comment!');
        return;
      }
      
      const comment = {
        text: commentText,
        author: 'Anonymous User',
        timestamp: new Date().toISOString(),
        id: Date.now()
      };
      
      const commentsList = document.getElementById('comments-list');
      const commentHTML = `
        <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 6px; border-left: 3px solid var(--primary-color);">
          <div style="font-size: 12px; color: var(--text-secondary);">
            <strong>${comment.author}</strong> • ${new Date(comment.timestamp).toLocaleString()}
          </div>
          <div style="margin-top: 5px; font-size: 14px;">
            ${comment.text}
          </div>
          <button onclick="deleteComment(${comment.id})" style="background: var(--error-color); color: white; border: none; padding: 4px 8px; border-radius: 4px; margin-top: 8px; cursor: pointer; font-size: 12px;">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      `;
      
      commentsList.insertAdjacentHTML('beforeend', commentHTML);
      commentInput.value = '';
      
      // Save to local storage for shared project
      const urlParams = new URLSearchParams(window.location.search);
      const shareId = urlParams.get('share');
      if (shareId) {
        let shareData = JSON.parse(localStorage.getItem(`share_${shareId}`)) || {};
        if (!shareData.comments) shareData.comments = [];
        shareData.comments.push(comment);
        localStorage.setItem(`share_${shareId}`, JSON.stringify(shareData));
      }
    }
    
    function deleteComment(commentId) {
      const urlParams = new URLSearchParams(window.location.search);
      const shareId = urlParams.get('share');
      if (!shareId) return;
      
      let shareData = JSON.parse(localStorage.getItem(`share_${shareId}`)) || {};
      if (shareData.comments) {
        shareData.comments = shareData.comments.filter(c => c.id !== commentId);
        localStorage.setItem(`share_${shareId}`, JSON.stringify(shareData));
        
        // Remove comment from UI
        document.getElementById(`comment-${commentId}`)?.remove();
        
        // If no comments left, show placeholder
        if (shareData.comments.length === 0) {
          document.getElementById('comments-list').innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No comments yet...</p>';
        }
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('✅ Copied to clipboard!');
      }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('✅ Copied to clipboard!');
      });
    }

    // ===== ENHANCED TEMPLATE SYSTEM =====
    function insertTemplate(type) {
      const templates = {
        'verse-chorus': `[Verse 1]
Write your first verse here...
Tell your story, set the scene

[Chorus]  
Write your chorus here...
This is the hook that repeats

[Verse 2]
Write your second verse here...
Continue your story

[Chorus]
Write your chorus here...
This is the hook that repeats

[Bridge]
Write your bridge here...
Something different, emotional peak

[Chorus]
Write your chorus here...
Final repetition with power`,
        
        'rap': `[Intro]
Yo, check it...
Set the vibe

[Verse 1]
Bar 1 - Set up the flow / Bar 2 - Keep it going strong
Bar 3 - Build up the story / Bar 4 - Make it hit hard
Bar 5 - Add some wordplay / Bar 6 - Keep the rhythm tight  
Bar 7 - Bring the energy / Bar 8 - End with impact

[Hook]
Hook line 1 - Make it catchy
Hook line 2 - Something that sticks

[Verse 2]
Bar 1 - Switch up the flow / Bar 2 - New perspective here
Bar 3 - Tell them the truth / Bar 4 - Make them feel it
Bar 5 - Layer the meaning / Bar 6 - Complex but clear
Bar 7 - Build to the climax / Bar 8 - Drop the mic moment

[Outro]
Final message...
Leave them thinking`,
        
        'ballad': `[Verse 1]
Slow, emotional verse here...
Paint the picture with gentle words
Let the feelings slowly build

[Pre-Chorus]
Building the emotion...
Leading to the release

[Chorus]
Powerful emotional chorus...
This is where hearts break or heal
Let the melody soar here

[Verse 2]
Continue the story...
Deeper into the emotion
New details, same feelings

[Bridge]
Emotional peak moment...
Raw vulnerability here
The climax of feeling

[Final Chorus]
Powerful emotional ending...
Resolution and catharsis
Leave them moved`,
        
        'hindi': `[मुखड़ा]
यहाँ मुख्य मुखड़ा लिखें...
यह वह हिस्सा है जो बार-बार आएगा

[अंतरा 1]
पहला अंतरा यहाँ लिखें...
कहानी की शुरुआत करें
भावनाओं को जगाएं

[मुखड़ा]
यहाँ मुख्य मुखड़ा लिखें...
यह वह हिस्सा है जो बार-बार आएगा

[अंतरा 2]  
दूसरा अंतरा यहाँ लिखें...
कहानी को आगे बढ़ाएं
नए जज्बात जोड़ें

[मुखड़ा]
यहाँ मुख्य मुखड़ा लिखें...
यह वह हिस्सा है जो बार-बार आएगा`,

        'edm': `[Build-Up]
Feel the energy rising...
Building to the drop
Hearts racing, anticipation

[Drop]
BASS HITS HARD
Synths exploding
Dance like there's no tomorrow
Feel the beat in your soul

[Breakdown]
Softer moment...
Catch your breath
But keep moving

[Build-Up 2]
Rising again...
Higher than before
Ready for the climax

[Final Drop]
Ultimate release...
Pure energy unleashed
Dance until dawn`,

        'country': `[Verse 1]
Down a dusty road in my hometown
Where the corn grows tall and the sun beats down
Got my boots on tight and my hat pulled low
There's a story here that you need to know

[Chorus]
'Cause this is country living
Where hearts are always giving
And the simple things in life
Cut through troubles like a knife

[Verse 2]
Mama's on the porch with her sweet tea
Daddy's in the barn, working endlessly
Family values run deeper than the well
We've got stories that we're proud to tell

[Chorus]
'Cause this is country living
Where hearts are always giving
And the simple things in life
Cut through troubles like a knife`
      };
      
      if (!pad || (!pad.value.trim() || confirm('This will replace current lyrics. Continue?'))) {
        if (!pad) {
          showTextEditor();
        }
        pad.value = templates[type] || '';
        if (current) {
          projects[current] = pad.value;
          saveProjects();
          trackChange(pad.value);
          updateStats();
          updateSyllableCounter();
        }
        pad.focus();
      }
    }

    function testAIFeatures() {
      alert('🧠 AI Features Test:\n\n✅ Real-time suggestions: Active\n✅ Smart rhyme detection: Working\n✅ Context awareness: Enabled\n✅ Emotion analysis: Running\n\nAll AI systems operational!');
    }

    function speakLyrics() {
      if (!pad || !pad.value.trim()) {
        alert('No lyrics to read! Please write some lyrics first.');
        return;
      }
      
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(pad.value);
        utterance.rate = 0.8;
        utterance.pitch = 1;
        utterance.volume = 0.8;
        speechSynthesis.speak(utterance);
        alert('🔊 Reading your lyrics aloud!');
      } else {
        alert('Text-to-speech not supported in your browser.');
      }
    }

    // ===== CORE FUNCTIONS REMAIN THE SAME =====
    function undo() {
      if (!pad) return;
      if (undoStack.length < 2) {
        alert('Nothing to undo!');
        return;
      }
      redoStack.push(undoStack.pop());
      const prev = undoStack[undoStack.length - 1];
      pad.value = prev;
      if (current) {
        projects[current] = prev;
        saveProjects();
      }
      updateStats();
      updateSyllableCounter();
    }
    
    function redo() {
      if (!pad) return;
      if (!redoStack.length) {
        alert('Nothing to redo!');
        return;
      }
      const next = redoStack.pop();
      undoStack.push(next);
      pad.value = next;
      if (current) {
        projects[current] = next;
        saveProjects();
      }
      updateStats();
      updateSyllableCounter();
    }

    // Enhanced search functionality
    searchBox.oninput = () => {
      const query = searchBox.value.trim().toLowerCase();
      const content = pad ? pad.value : '';
      if (query && content.toLowerCase().includes(query)) {
        rhymes.innerHTML = `<strong><i class="fas fa-search"></i> Search Result:</strong> "${query}" found in lyrics. <button onclick="highlightSearch('${query}')" style="margin-left: 10px; padding: 4px 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;"><i class="fas fa-highlight"></i> Highlight</button>`;
      } else if (query) {
        rhymes.innerHTML = `<strong><i class="fas fa-search"></i> Search:</strong> "${query}" not found.`;
      } else {
        rhymes.innerHTML = "";
      }
    };

    function highlightSearch(query) {
      if (!pad) return;
      const text = pad.value;
      const index = text.toLowerCase().indexOf(query.toLowerCase());
      if (index !== -1) {
        pad.focus();
        pad.setSelectionRange(index, index + query.length);
      }
    }

    // Enhanced theme toggle
    document.getElementById('darkToggle').onclick = function() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
      this.innerHTML = document.body.classList.contains('dark') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    };

    // Enhanced keyboard shortcuts with new AI features
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 's':
            e.preventDefault();
            saveToFile();
            break;
          case 'n':
            e.preventDefault();
            addNewUntitledProject();
            break;
          case 'o':
            e.preventDefault();
            document.getElementById('fileInput').click();
            break;
          case 'p':
            e.preventDefault();
            exportPDF();
            break;
          case 'z':
            e.preventDefault();
            undo();
            break;
          case 'y':
            e.preventDefault();
            redo();
            break;
          case 'r':
            e.preventDefault();
            promptSuggestRhymes();
            break;
          case 'g':
            e.preventDefault();
            generateLyrics();
            break;
          case 'm':
            e.preventDefault();
            toggleVoiceToText();
            break;
          case 'f':
            e.preventDefault();
            searchBox.focus();
            break;
          case 'd':
            e.preventDefault();
            document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', document.body.classList.contains('dark'));
            break;
          case ',':
            e.preventDefault();
            showSettings();
            break;
          case 'b':
            if (document.activeElement === pad) {
              e.preventDefault();
              document.execCommand('bold');
              updateOnTextFormat();
            }
            break;
          case 'i':
            if (document.activeElement === pad) {
              e.preventDefault();
              document.execCommand('italic');
              updateOnTextFormat();
            }
            break;
          case 'u':
            if (document.activeElement === pad) {
              e.preventDefault();
              document.execCommand('underline');
              updateOnTextFormat();
            }
            break;
        }
      }
      
      if (e.key === 'F11') {
        e.preventDefault();
        toggleFocusMode();
      }
      
      if (e.key === 'Escape') {
        hideSettings();
        hideVoiceModal();
        hideDonateModal();
        hideInspireModal();
        if (focusModeEnabled) toggleFocusMode();
        if (isVoiceToText) stopVoiceToText();
      }
    });

    function updateOnTextFormat() {
      if (current && pad) {
        projects[current] = pad.value;
        saveProjects();
        trackChange(pad.value);
        updateStats();
        updateSyllableCounter();
      }
    }

    // Modal click handlers
    document.getElementById('settingsModal').onclick = function(e) {
      if (e.target === this) hideSettings();
    };

    document.getElementById('voiceModal').onclick = function(e) {
      if (e.target === this) hideVoiceModal();
    };

    document.getElementById('donateModal').onclick = function(e) {
      if (e.target === this) hideDonateModal();
    };

    document.getElementById('inspireModal').onclick = function(e) {
      if (e.target === this) hideInspireModal();
    };

    // Auto-save functionality
    setInterval(() => {
      if (document.getElementById('auto-save')?.checked && current && pad) {
        projects[current] = pad.value;
        saveProjects();
      }
    }, 30000);

    // Creativity slider update
    const creativitySlider = document.getElementById('creativity-level');
    const creativityValue = document.getElementById('creativity-value');
    if (creativitySlider && creativityValue) {
      creativitySlider.oninput = function() {
        creativityValue.textContent = this.value;
      };
    }

    // ===== INITIALIZATION FUNCTION =====
    function initializeApp() {
      // Initialize with welcome project if no projects exist
      if (Object.keys(projects).length === 0) {
        projects['Welcome to LiLyrics v2.5 Premiere'] = `Welcome to LiLyrics v2.5 Premiere - Ultimate Edition! 👑

🆕 NEW FEATURES:
✅ Syllable Counter - Real-time syllable counting for perfect rhythm
✅ AI Lyric Generator - Complete verse/chorus generation  
✅ Near Rhymes - Advanced rhyme suggestions beyond perfect matches
✅ Voice-to-Text - Speak your lyrics directly into the editor
✅ Collaboration - Real-time co-writing with comments
✅ Line Numbers - Professional editor with line tracking
✅ Enhanced AI - Context-aware suggestions and emotion analysis
✅ 12+ Templates - Genre-specific song structures

🎵 ALL PREMIUM FEATURES:
• AI Mega Rhymes (30 lakh+ words)
• 2000+ Creative inspiration prompts
• Voice recording and playback
• Professional export options
• Song templates for all genres
• Settings with 4 essential tabs
• Keyboard shortcuts for everything
• Mobile-optimized interface

Your ultimate songwriting experience starts here!
Write your masterpiece with industry-leading tools - all free forever! 🎶✨`;
        current = 'Welcome to LiLyrics v2.5 Premiere';
        untitledCounter = 1;
      }
      
      // Load current project
      const projectKeys = Object.keys(projects);
      if (projectKeys.length > 0) {
        current = current || projectKeys[0];
        showTextEditor();
        loadProject(current);
      } else {
        showEmptyState();
      }
      
      updateTabs();
      
      // Load user preferences
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark');
        document.getElementById('darkToggle').innerHTML = '<i class="fas fa-sun"></i>';
      }
      
      // Load interface preferences
      if (localStorage.getItem('syllableCounterEnabled') === 'false') {
        document.getElementById('syllable-counter').style.display = 'none';
      }
      if (localStorage.getItem('lineNumbersEnabled') === 'false') {
        document.getElementById('line-numbers').style.display = 'none';
      }
      
      // Load button preferences
      loadButtonPreferences();
      
      // Check if banner was previously closed
      if (localStorage.getItem('bannerClosed') === 'true') {
        document.getElementById('lifetimeBanner').style.display = 'none';
      }
      
      // Initialize voice recognition
      initializeVoiceToText();
      
      // Check for shared project
      const urlParams = new URLSearchParams(window.location.search);
      const shareId = urlParams.get('share');
      if (shareId) {
        loadSharedProject(shareId);
      }
      
      // Show welcome message
      setTimeout(() => {
        if (current === 'Welcome to LiLyrics v2.5 Premiere') {
          alert('🎉 Welcome to LiLyrics v2.5 Premiere!\n\n👑 ULTIMATE EDITION FEATURES:\n✅ Syllable counter for perfect rhythm\n✅ AI lyric generator with context awareness\n✅ Near rhymes and advanced suggestions\n✅ Voice-to-text for hands-free writing\n✅ Real-time collaboration system\n✅ 12+ professional song templates\n✅ Enhanced mobile experience\n\nYour industry-leading songwriting studio is ready!');
        }
      }, 1500);
    }

    function loadSharedProject(shareId) {
      const shareData = JSON.parse(localStorage.getItem(`share_${shareId}`));
      if (shareData) {
        projects[shareData.projectName] = shareData.content;
        current = shareData.projectName;
        showTextEditor();
        loadProject(current);
        updateTabs();
        
        // Show collaboration panel
        setTimeout(() => {
          toggleCollaboration();
          alert('📝 Collaborative project loaded!\n\nYou can now view and add comments using the collaboration panel.');
        }, 1000);
      }
    }

    // ===== START THE ULTIMATE PREMIERE APP =====
    
    // Initialize app immediately with all enhanced features
    initializeApp();
    
  </script>
</body>
</html>
